<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASIS Boats - Professional Quotation System V12</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --navy: #0f2847; --navy-dark: #0a1628; --navy-light: #1a3a5c;
            --gold: #c9a227; --gold-light: #e8c547; --gold-dark: #a68521;
            --white: #ffffff; --gray-100: #f8f9fa; --gray-200: #e9ecef; --gray-300: #dee2e6;
            --gray-400: #ced4da; --gray-500: #adb5bd; --gray-600: #6c757d; --gray-700: #495057;
            --success: #28a745; --danger: #dc3545; --warning: #ffc107;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Montserrat', sans-serif; background: var(--gray-100); min-height: 100vh; }
        
        /* Header */
        .header { background: linear-gradient(135deg, var(--navy-dark), var(--navy)); padding: 20px 30px; position: sticky; top: 0; z-index: 100; box-shadow: 0 4px 20px rgba(0,0,0,0.2); }
        .header-inner { max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
        .logo-area { display: flex; align-items: center; gap: 20px; }
        .logo-divider { width: 1px; height: 40px; background: linear-gradient(180deg, transparent, var(--gold), transparent); }
        .logo-text span { font-size: 10px; color: var(--gold); text-transform: uppercase; letter-spacing: 2px; }
        .logo-text h1 { color: var(--white); font-size: 20px; font-weight: 600; }
        .header-right { display: flex; align-items: center; gap: 15px; }
        .quote-badge { background: rgba(201,162,39,0.15); border: 1px solid var(--gold); color: var(--gold); padding: 10px 20px; border-radius: 8px; font-weight: 600; font-size: 14px; }
        
        /* Progress */
        .progress-bar { background: var(--navy-dark); padding: 20px 30px; border-top: 1px solid rgba(255,255,255,0.1); }
        .progress-inner { max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; position: relative; }
        .progress-inner::before { content: ''; position: absolute; top: 20px; left: 60px; right: 60px; height: 2px; background: rgba(255,255,255,0.2); }
        .step { display: flex; flex-direction: column; align-items: center; cursor: pointer; position: relative; z-index: 1; }
        .step-num { width: 40px; height: 40px; border-radius: 50%; background: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.3); display: flex; align-items: center; justify-content: center; color: var(--gray-500); font-weight: 600; font-size: 14px; margin-bottom: 8px; transition: all 0.3s; }
        .step-label { font-size: 11px; color: var(--gray-500); text-transform: uppercase; letter-spacing: 1px; transition: all 0.3s; }
        .step.active .step-num { background: var(--gold); border-color: var(--gold); color: var(--navy-dark); box-shadow: 0 0 20px rgba(201,162,39,0.4); }
        .step.active .step-label { color: var(--gold); }
        .step.done .step-num { background: var(--success); border-color: var(--success); color: white; }
        .step.done .step-label { color: var(--success); }
        
        /* Main */
        .main { max-width: 1400px; margin: 0 auto; padding: 30px; }
        .page { display: none; animation: fadeIn 0.4s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Layout */
        .layout { display: grid; grid-template-columns: 1fr 350px; gap: 25px; }
        @media (max-width: 1100px) { .layout { grid-template-columns: 1fr; } }
        
        /* Cards */
        .card { background: var(--white); border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.08); margin-bottom: 20px; overflow: hidden; }
        .card-header { background: linear-gradient(135deg, var(--navy), var(--navy-light)); padding: 18px 22px; display: flex; justify-content: space-between; align-items: center; }
        .card-header h2 { color: var(--white); font-size: 14px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; display: flex; align-items: center; gap: 10px; }
        .card-header h2::before { content: ''; width: 4px; height: 20px; background: var(--gold); border-radius: 2px; }
        .card-body { padding: 22px; }
        
        /* Boat Types */
        .boat-types { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        @media (max-width: 900px) { .boat-types { grid-template-columns: 1fr; } }
        .boat-type { background: var(--gray-100); border: 2px solid var(--gray-200); border-radius: 12px; padding: 25px; cursor: pointer; transition: all 0.3s; text-align: center; position: relative; overflow: hidden; }
        .boat-type::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px; background: var(--gray-300); transition: all 0.3s; }
        .boat-type:hover { border-color: var(--navy); transform: translateY(-3px); box-shadow: 0 8px 25px rgba(0,0,0,0.1); }
        .boat-type:hover::before { background: var(--navy); }
        .boat-type.selected { border-color: var(--gold); background: linear-gradient(135deg, #fffef5, #fff9e6); }
        .boat-type.selected::before { background: var(--gold); }
        .boat-type-icon { width: 80px; height: 80px; margin: 0 auto 15px; background: var(--white); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 40px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
        .boat-type h3 { font-size: 18px; font-weight: 700; color: var(--navy); margin-bottom: 8px; }
        .boat-type p { font-size: 13px; color: var(--gray-600); margin-bottom: 15px; }
        .boat-type-stats { display: flex; justify-content: center; gap: 25px; padding-top: 15px; border-top: 1px solid var(--gray-300); }
        .stat { text-align: center; }
        .stat-val { font-size: 16px; font-weight: 700; color: var(--navy); }
        .stat-label { font-size: 10px; color: var(--gray-500); text-transform: uppercase; }
        
        /* Boat Sizes */
        .boat-sizes { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 12px; }
        .boat-size { background: var(--gray-100); border: 2px solid var(--gray-200); border-radius: 10px; padding: 18px; cursor: pointer; text-align: center; transition: all 0.3s; }
        .boat-size:hover { border-color: var(--navy); transform: translateY(-2px); }
        .boat-size.selected { border-color: var(--gold); background: linear-gradient(135deg, #fffef5, #fff9e6); }
        .boat-size .size { font-size: 22px; font-weight: 700; color: var(--navy); }
        .boat-size .price { font-size: 15px; font-weight: 600; color: var(--gold-dark); margin: 6px 0; }
        .boat-size .specs { font-size: 11px; color: var(--gray-500); }
        
        /* Summary Sidebar */
        .summary { background: linear-gradient(135deg, var(--navy-dark), var(--navy)); border-radius: 12px; padding: 22px; color: var(--white); position: sticky; top: 180px; }
        .summary-title { font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 1px; color: var(--gold); margin-bottom: 15px; padding-bottom: 12px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .summary-row { display: flex; justify-content: space-between; padding: 8px 0; font-size: 13px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .summary-row .lbl { color: var(--gray-400); }
        .summary-row .val { font-weight: 600; }
        .summary-total { display: flex; justify-content: space-between; padding: 15px 0; margin-top: 10px; border-top: 2px solid var(--gold); font-size: 18px; font-weight: 700; }
        .summary-total .lbl { color: var(--gold); }
        .curr-btns { display: flex; gap: 5px; margin-top: 15px; }
        .rate-info { font-size: 11px; color: var(--gray-500); margin-top: 8px; text-align: center; }
        .curr-btn { flex: 1; padding: 10px; border: 1px solid rgba(255,255,255,0.2); background: transparent; color: var(--gray-400); border-radius: 6px; cursor: pointer; font-size: 11px; font-weight: 600; transition: all 0.3s; }
        .curr-btn.active { background: var(--gold); border-color: var(--gold); color: var(--navy-dark); }
        
        /* Categories */
        .category { background: var(--white); border: 1px solid var(--gray-200); border-radius: 10px; margin-bottom: 12px; overflow: hidden; box-shadow: 0 2px 6px rgba(0,0,0,0.04); }
        .cat-header { background: linear-gradient(135deg, var(--navy), var(--navy-light)); color: var(--white); padding: 14px 18px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: background 0.2s; }
        .cat-header:hover { background: linear-gradient(135deg, var(--navy-light), var(--navy)); }
        .cat-header h3 { font-size: 13px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin: 0; display: flex; align-items: center; }
        .cat-header .cat-total { background: var(--gold); color: var(--navy-dark); padding: 4px 12px; border-radius: 15px; font-size: 12px; font-weight: 600; }
        .cat-header .arrow { font-size: 10px; margin-left: 10px; transition: transform 0.3s; }
        .cat-header.open .arrow { transform: rotate(180deg); }
        .cat-content { max-height: 0; overflow: hidden; transition: max-height 0.4s ease; }
        .cat-content.open { max-height: 3000px; }
        
        /* Main Category Groups */
        .main-group { margin-bottom: 20px; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.08); }
        .main-group-header { background: linear-gradient(135deg, #1a365d, #2d4a7c); color: var(--white); padding: 18px 22px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .main-group-header:hover { background: linear-gradient(135deg, #2d4a7c, #1a365d); }
        .main-group-header h2 { font-size: 16px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; margin: 0; display: flex; align-items: center; gap: 12px; }
        .main-group-header h2 .group-icon { font-size: 22px; }
        .main-group-header .group-total { background: var(--gold); color: var(--navy-dark); padding: 6px 16px; border-radius: 20px; font-size: 14px; font-weight: 700; }
        .main-group-header .group-arrow { font-size: 14px; margin-left: 12px; transition: transform 0.3s; }
        .main-group-header.open .group-arrow { transform: rotate(180deg); }
        .main-group-content { max-height: 0; overflow: hidden; transition: max-height 0.5s ease; background: var(--gray-50); }
        .main-group-content.open { max-height: 15000px; }
        .main-group-inner { padding: 15px; }
        .main-group-inner .category { margin-bottom: 10px; }
        
        /* Flat category (top-level like Propulsion) */
        .flat-category { margin-bottom: 20px; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.08); }
        .flat-category .cat-header { background: linear-gradient(135deg, #1a365d, #2d4a7c); padding: 18px 22px; }
        .flat-category .cat-header h3 { font-size: 16px; font-weight: 700; letter-spacing: 1px; }
        .flat-category .cat-total { padding: 6px 16px; border-radius: 20px; font-size: 14px; font-weight: 700; }
        
        /* Nested subgroup (e.g., Seating within ASIS Accessories) */
        .subgroup { margin-bottom: 10px; border-radius: 8px; overflow: hidden; border: 1px solid var(--gray-300); }
        .subgroup-header { background: linear-gradient(135deg, #4a5568, #718096); color: var(--white); padding: 12px 16px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; }
        .subgroup-header:hover { background: linear-gradient(135deg, #718096, #4a5568); }
        .subgroup-header h4 { font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin: 0; }
        .subgroup-header .subgroup-total { background: var(--gold); color: var(--navy-dark); padding: 3px 10px; border-radius: 12px; font-size: 11px; font-weight: 600; }
        .subgroup-header .subgroup-arrow { font-size: 10px; margin-left: 10px; transition: transform 0.3s; }
        .subgroup-header.open .subgroup-arrow { transform: rotate(180deg); }
        .subgroup-content { max-height: 0; overflow: hidden; transition: max-height 0.4s ease; background: var(--gray-100); }
        .subgroup-content.open { max-height: 5000px; }
        .subgroup-inner { padding: 10px; }
        .subgroup-inner .category { margin-bottom: 8px; }
        
        .cat-inner { padding: 15px; }
        
        /* Item Grid */
        .item-grid-header { display: grid; grid-template-columns: 2fr 70px 110px 100px 40px; gap: 10px; padding: 10px 12px; background: var(--gray-100); border-radius: 6px; margin-bottom: 10px; }
        .item-grid-header span { font-size: 10px; font-weight: 600; color: var(--gray-600); text-transform: uppercase; }
        .item-grid-header .right { text-align: right; }
        
        .item-row { display: grid; grid-template-columns: 2fr 70px 110px 100px 40px; gap: 10px; padding: 12px; border-bottom: 1px solid var(--gray-200); align-items: center; transition: background 0.2s; }
        .item-row:hover { background: var(--gray-100); }
        .item-row:last-of-type { border-bottom: none; }
        .item-row select { width: 100%; padding: 10px; border: 1px solid var(--gray-300); border-radius: 6px; font-size: 13px; background: var(--white); cursor: pointer; }
        .item-row select:focus { outline: none; border-color: var(--gold); }
        .item-row input[type="number"] { width: 100%; padding: 10px; border: 1px solid var(--gray-300); border-radius: 6px; text-align: center; font-size: 13px; font-weight: 500; }
        .item-row .price-input { text-align: right; font-weight: 600; color: var(--gray-700); }
        .item-row .extended { font-weight: 700; color: var(--success); text-align: right; font-size: 14px; }
        .item-row .tbd { color: var(--warning); font-style: italic; }
        .delete-btn { width: 36px; height: 36px; border: none; background: var(--danger); color: var(--white); border-radius: 6px; cursor: pointer; font-size: 18px; transition: all 0.2s; display: flex; align-items: center; justify-content: center; }
        .delete-btn:hover { background: #c82333; transform: scale(1.05); }
        .add-btn { background: var(--success); color: var(--white); border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-size: 13px; font-weight: 600; margin-top: 12px; transition: all 0.2s; display: inline-flex; align-items: center; gap: 8px; }
        .add-btn:hover { background: #218838; transform: translateY(-1px); }
        
        .custom-input { width: 100%; padding: 10px; border: 2px dashed var(--gold); border-radius: 6px; font-size: 13px; background: #fffef5; }
        .custom-input:focus { outline: none; border-style: solid; }
        
        /* Forms */
        .form-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        @media (max-width: 600px) { .form-grid { grid-template-columns: 1fr; } }
        .form-group { display: flex; flex-direction: column; }
        .form-group.full { grid-column: span 2; }
        .form-group label { font-size: 11px; font-weight: 600; color: var(--gray-600); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 6px; }
        .form-group input, .form-group select, .form-group textarea { padding: 12px 14px; border: 2px solid var(--gray-200); border-radius: 8px; font-size: 14px; font-family: inherit; transition: border-color 0.3s; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: var(--gold); }
        
        /* Buttons */
        .btn { padding: 14px 28px; border: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; transition: all 0.3s; display: inline-flex; align-items: center; gap: 10px; text-transform: uppercase; letter-spacing: 0.5px; }
        .btn-primary { background: linear-gradient(135deg, var(--gold), var(--gold-dark)); color: var(--navy-dark); box-shadow: 0 4px 15px rgba(201,162,39,0.3); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(201,162,39,0.4); }
        .btn-secondary { background: var(--gray-200); color: var(--gray-700); }
        .btn-secondary:hover { background: var(--gray-300); }
        .btn-success { background: linear-gradient(135deg, var(--success), #1e7e34); color: var(--white); }
        .btn-outline { background: linear-gradient(135deg, #4a5568, #718096); color: var(--white); border: none; }
        .btn-outline:hover { background: linear-gradient(135deg, #2d3748, #4a5568); color: var(--white); }
        .actions { display: flex; justify-content: space-between; margin-top: 25px; padding-top: 25px; border-top: 1px solid var(--gray-200); }
        
        /* Preview */
        .preview { background: var(--white); border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); overflow: hidden; }
        .preview-header { background: var(--navy); color: var(--white); padding: 40px; text-align: center; }
        .preview-header h1 { font-size: 28px; font-weight: 700; margin-bottom: 5px; }
        .preview-header p { color: var(--gold); font-size: 14px; letter-spacing: 2px; }
        .preview-body { padding: 40px; }
        .preview-meta { display: grid; grid-template-columns: repeat(2, 1fr); gap: 30px; margin-bottom: 30px; padding-bottom: 30px; border-bottom: 2px solid var(--gray-200); }
        .preview-meta h4 { color: var(--navy); font-size: 12px; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; }
        .preview-meta p { font-size: 14px; color: var(--gray-700); line-height: 1.8; }
        .preview-table { width: 100%; border-collapse: collapse; margin-bottom: 30px; }
        .preview-table th { background: var(--navy); color: var(--white); padding: 14px; text-align: left; font-size: 12px; text-transform: uppercase; }
        .preview-table th.right { text-align: right; }
        .preview-table td { padding: 14px; border-bottom: 1px solid var(--gray-200); font-size: 14px; }
        .preview-table td.right { text-align: right; }
        .preview-totals { text-align: right; }
        .preview-totals div { padding: 8px 0; font-size: 15px; }
        .preview-totals .grand { font-size: 20px; font-weight: 700; color: var(--navy); border-top: 2px solid var(--navy); padding-top: 15px; margin-top: 10px; }
        .preview-notes { margin-top: 30px; padding: 20px; background: var(--gray-100); border-radius: 8px; border-left: 4px solid var(--gold); }
        .preview-notes h4 { color: var(--navy); font-size: 12px; text-transform: uppercase; margin-bottom: 10px; }
        .preview-notes p { font-size: 14px; color: var(--gray-700); white-space: pre-wrap; }

        /* Selected Items */
        .selected-items { max-height: 300px; overflow-y: auto; }
        .sel-item { display: flex; justify-content: space-between; padding: 6px 0; font-size: 12px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .sel-item .name { color: var(--gray-300); max-width: 180px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
        .sel-item .amt { color: var(--gold-light); font-weight: 600; }

        /* Info banner */
        .info-banner { background: linear-gradient(135deg, #e3f2fd, #bbdefb); border: 1px solid #90caf9; border-radius: 8px; padding: 15px 20px; margin-bottom: 20px; display: flex; align-items: center; gap: 12px; }
        .info-banner .icon { font-size: 24px; }
        .info-banner .text { font-size: 13px; color: #1565c0; }
        .info-banner .text strong { display: block; margin-bottom: 3px; }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-inner">
            <div class="logo-area">
                <div class="logo-text">
                    <span>Advanced Maritime Solutions</span>
                    <h1>ASIS BOATS</h1>
                </div>
            </div>
            <div class="header-right">
                <div class="quote-badge" id="quoteBadge">ASIS-25-0001</div>
            </div>
        </div>
    </header>

    <nav class="progress-bar">
        <div class="progress-inner">
            <div class="step active" onclick="goTo(1)"><div class="step-num">1</div><div class="step-label">Boat Selection</div></div>
            <div class="step" onclick="goTo(2)"><div class="step-num">2</div><div class="step-label">Configuration</div></div>
            <div class="step" onclick="goTo(3)"><div class="step-num">3</div><div class="step-label">Information</div></div>
            <div class="step" onclick="goTo(4)"><div class="step-num">4</div><div class="step-label">Review</div></div>
        </div>
    </nav>

    <main class="main">
        <!-- PAGE 1: BOAT SELECTION -->
        <div id="page1" class="page active">
            <div class="layout">
                <div>
                    <div class="card">
                        <div class="card-header"><h2>Select Boat Type</h2></div>
                        <div class="card-body">
                            <div class="boat-types" id="boatTypesGrid"></div>
                        </div>
                    </div>
                    <div class="card" id="sizesCard" style="display:none;">
                        <div class="card-header"><h2>Select Size</h2></div>
                        <div class="card-body">
                            <div class="boat-sizes" id="boatSizesGrid"></div>
                        </div>
                    </div>
                    <div class="actions">
                        <div></div>
                        <button class="btn btn-primary" onclick="goTo(2)" id="nextBtn1" disabled>Continue to Configuration ‚Üí</button>
                    </div>
                </div>
                <aside>
                    <div class="summary">
                        <div class="summary-title">Quote Summary</div>
                        <div class="summary-row"><span class="lbl">Boat Type</span><span class="val" id="sumType">-</span></div>
                        <div class="summary-row"><span class="lbl">Size</span><span class="val" id="sumSize">-</span></div>
                        <div class="summary-row"><span class="lbl">Base Price</span><span class="val" id="sumBase">-</span></div>
                        <div class="summary-row"><span class="lbl">Options & Accessories</span><span class="val" id="sumOptions">$0</span></div>
                        <div class="summary-total"><span class="lbl">Total</span><span class="val" id="sumTotal">$0</span></div>
                        <div class="curr-btns">
                            <button class="curr-btn active" onclick="setCurrency('USD')">USD</button>
                            <button class="curr-btn" onclick="setCurrency('AED')">AED</button>
                            <button class="curr-btn" onclick="setCurrency('EUR')">EUR</button>
                        </div>
                        <div id="rateInfo1" class="rate-info"></div>
                    </div>
                </aside>
            </div>
        </div>

        <!-- PAGE 2: CONFIGURATION -->
        <div id="page2" class="page">
            <div class="layout">
                <div>
                    <div class="info-banner">
                        <span class="icon">‚ÑπÔ∏è</span>
                        <div class="text">
                            <strong>Accessories shown are specific to your selected boat type and size.</strong>
                            Items marked "TBD" have pricing to be determined. Items not available for your boat size are hidden.
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h2>Configure Your Boat</h2>
                            <span style="color:var(--gold);font-size:12px;" id="selectedBoatLabel">-</span>
                        </div>
                        <div class="card-body" style="padding:0;">
                            <div id="categoriesContainer"></div>
                        </div>
                    </div>
                    <div class="actions">
                        <button class="btn btn-secondary" onclick="goTo(1)">‚Üê Back</button>
                        <button class="btn btn-primary" onclick="goTo(3)">Continue to Information ‚Üí</button>
                    </div>
                </div>
                <aside>
                    <div class="summary">
                        <div class="summary-title">Selected Items</div>
                        <div class="selected-items" id="selectedItemsList"></div>
                        <div class="summary-total"><span class="lbl">Total</span><span class="val" id="sumTotal2">$0</span></div>
                        <div class="curr-btns">
                            <button class="curr-btn active" onclick="setCurrency('USD')">USD</button>
                            <button class="curr-btn" onclick="setCurrency('AED')">AED</button>
                            <button class="curr-btn" onclick="setCurrency('EUR')">EUR</button>
                        </div>
                        <div id="rateInfo2" class="rate-info"></div>
                    </div>
                </aside>
            </div>
        </div>

        <!-- PAGE 3: INFORMATION -->
        <div id="page3" class="page">
            <div class="layout">
                <div>
                    <div class="card">
                        <div class="card-header"><h2>Quote Information</h2></div>
                        <div class="card-body">
                            <div class="form-grid">
                                <div class="form-group" style="grid-column: span 2;"><label>Quotation Title</label><input type="text" id="quoteTitle" placeholder="e.g., 12m Aluminum RIB Boats" autocomplete="off"></div>
                                <div class="form-group"><label>Quote Number</label><input type="text" id="quoteNum" value="ASIS-25-0001" onchange="document.getElementById('quoteBadge').textContent=this.value" autocomplete="off"></div>
                                <div class="form-group"><label>Date</label><input type="date" id="quoteDate"></div>
                                <div class="form-group"><label>Validity</label><select id="validity"><option selected>30 Days</option><option>90 Days</option></select></div>
                                <div class="form-group"><label>Salesman</label><select id="salesman"><option value="">-- Select Salesman --</option><option value="mario">Mario Hoyek</option><option value="soufiane">Soufiane Tangi</option><option value="toji">Toji Paul</option></select></div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header"><h2>Customer Information</h2></div>
                        <div class="card-body">
                            <div class="form-grid">
                                <div class="form-group"><label>Company / Organization</label><input type="text" id="custCompany" placeholder="Company name"></div>
                                <div class="form-group"><label>Contact Person</label><input type="text" id="custName" placeholder="Full name"></div>
                                <div class="form-group"><label>Email</label><input type="email" id="custEmail" placeholder="email@company.com"></div>
                                <div class="form-group"><label>Phone</label><input type="tel" id="custPhone" placeholder="+971 XX XXX XXXX"></div>
                                <div class="form-group"><label>Tender Number <span style="font-weight:400;color:var(--gray-500);">(Optional)</span></label><input type="text" id="tenderNum" placeholder="Tender/RFQ number"></div>
                                <div class="form-group"><label>Address / Country</label><textarea id="custAddr" rows="2" placeholder="Address or country"></textarea></div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header"><h2>Terms & Conditions</h2></div>
                        <div class="card-body">
                            <div class="form-grid">
                                <div class="form-group"><label>Payment Terms</label><select id="payTerms"><option>50% Deposit, 50% on Delivery</option><option>30% / 70%</option><option>100% on Order</option></select></div>
                                <div class="form-group"><label>Delivery Terms</label><input type="text" id="deliveryTerms" value="Ex Factory" placeholder="Ex Factory, FOB, CIF, etc."></div>
                                <div class="form-group">
                                    <label>Delivery Timeline</label>
                                    <select id="deliverySelect" onchange="toggleDeliveryInput()">
                                        <option value="TBD" selected>TBD</option>
                                        <option value="60-90 Days">60-90 Days</option>
                                        <option value="90-120 Days">90-120 Days</option>
                                        <option value="custom">Custom...</option>
                                    </select>
                                    <input type="text" id="deliveryCustom" placeholder="Enter custom timeline" style="display:none;margin-top:8px;">
                                </div>
                                <div class="form-group"><label>Discount %</label><input type="number" id="discount" value="0" min="0" max="100" onchange="updateTotals()"></div>
                                <div class="form-group" style="display:flex;align-items:center;gap:10px;padding-top:20px;">
                                    <input type="checkbox" id="hideSubPrices" checked style="width:18px;height:18px;cursor:pointer;">
                                    <label for="hideSubPrices" style="margin:0;cursor:pointer;font-weight:normal;">Hide individual prices (show only total)</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header"><h2>Notes</h2></div>
                        <div class="card-body">
                            <div class="form-group full">
                                <textarea id="quoteNotes" rows="4" placeholder="Additional notes, special requirements, or comments for this quotation..."></textarea>
                            </div>
                        </div>
                    </div>
                    <div class="actions">
                        <button class="btn btn-secondary" onclick="goTo(2)">‚Üê Back</button>
                        <button class="btn btn-primary" onclick="goTo(4)">Preview Quotation ‚Üí</button>
                    </div>
                </div>
                <aside>
                    <div class="summary">
                        <div class="summary-title">Order Summary</div>
                        <div class="summary-row"><span class="lbl">Subtotal</span><span class="val" id="sumSub3">$0</span></div>
                        <div class="summary-row"><span class="lbl">Discount</span><span class="val" id="sumDisc3">-$0</span></div>
                        <div class="summary-total"><span class="lbl">Grand Total</span><span class="val" id="sumTotal3">$0</span></div>
                    </div>
                </aside>
            </div>
        </div>

        <!-- PAGE 4: REVIEW & EXPORT -->
        <div id="page4" class="page">
            <div class="card" style="margin-bottom:20px;">
                <div class="card-header">
                    <h2>Quotation Preview</h2>
                    <div style="display:flex;gap:10px;">
                        <button class="btn btn-success" onclick="downloadPDF()">üìÑ Download PDF</button>
                        <button class="btn btn-outline" onclick="downloadCSV()">üìä Export CSV</button>
                        <button class="btn btn-outline" onclick="window.print()">üñ®Ô∏è Print</button>
                    </div>
                </div>
            </div>
            <div class="preview" id="previewArea">
                <div class="preview-header">
                    <h1>ASIS BOATS LLC</h1>
                    <p>PROFESSIONAL QUOTATION</p>
                    <p id="prevQuoteTitle" style="font-size:18px;margin-top:10px;color:var(--white);font-weight:600;"></p>
                </div>
                <div class="preview-body">
                    <div class="preview-meta">
                        <div><h4>Quotation Details</h4><p id="prevQuoteInfo"></p></div>
                        <div><h4>Customer</h4><p id="prevCustInfo"></p></div>
                    </div>
                    <table class="preview-table">
                        <thead><tr><th>Description</th><th>Qty</th><th class="right">Unit Price</th><th class="right">Total</th></tr></thead>
                        <tbody id="prevItems"></tbody>
                    </table>
                    <div class="preview-totals" id="prevTotals"></div>
                    <div class="preview-notes" id="prevNotes" style="display:none;"><h4>Notes</h4><p id="prevNotesText"></p></div>
                </div>
            </div>
            <div class="actions">
                <button class="btn btn-secondary" onclick="goTo(3)">‚Üê Edit</button>
                <button class="btn btn-primary" onclick="downloadPDF()">Generate & Download PDF</button>
            </div>
        </div>
    </main>

<script>
// ==================== DATA FROM EXCEL ====================
const BOATS = {
    aluminum: {
        name: 'Aluminium Boats', 
        desc: 'Professional-grade aluminum hull RHIBs', 
        icon: 'üö§',
        sizes: [
            {size:'6.5M', price:103090, fuel:'150L', pax:8},
            {size:'7.6M', price:120030, fuel:'450L', pax:10},
            {size:'8.5M', price:149800, fuel:'600L', pax:12},
            {size:'9.5M', price:180765, fuel:'600L', pax:14},
            {size:'11.5M', price:246770, fuel:'1200L', pax:18},
            {size:'13M', price:289475, fuel:'1100L', pax:20}
        ]
    },
    fiberglass: {
        name: 'Fiberglass Boats (GRP)', 
        desc: 'Versatile GRP construction RHIBs', 
        icon: '‚õµ',
        sizes: [
            {size:'4.1M', price:22900, fuel:'N/A', pax:4},
            {size:'5.1M', price:33560, fuel:'90L', pax:6},
            {size:'5.5M', price:35000, fuel:'90L', pax:6},
            {size:'6.5M', price:53040, fuel:'225L', pax:8},
            {size:'7.2M', price:56850, fuel:'225L', pax:10},
            {size:'8.0M', price:66560, fuel:'225L', pax:12},
            {size:'8.5M', price:83200, fuel:'225L', pax:14},
            {size:'9.5M', price:130080, fuel:'2x350L', pax:16},
            {size:'12M', price:160960, fuel:'2x300L', pax:20}
        ]
    },
    inflatable: {
        name: 'Inflatable Boats (HDIB)', 
        desc: 'Heavy Duty Inflatable Boats', 
        icon: 'üõü',
        sizes: [
            {size:'2.8M', price:8300, fuel:'N/A', pax:3},
            {size:'3.2M', price:9800, fuel:'N/A', pax:4},
            {size:'3.5M', price:10800, fuel:'N/A', pax:5},
            {size:'4.2M', price:12600, fuel:'N/A', pax:6},
            {size:'4.8M', price:15700, fuel:'N/A', pax:7},
            {size:'5.1M', price:16900, fuel:'N/A', pax:8}
        ]
    }
};

// Accessories by boat type - from Excel price list
// Each item has prices object keyed by size, with values: number, "X" (unavailable), "TBD", or "Incl."
const ACCESSORIES = {
    aluminum: {
        "Propulsion / Engine": [
            {name: "Single Mercury F150Hp EXLPT (incl. controls, steering, gauges)", prices: {"6.5M":18620,"7.6M":"X","8.5M":"X","9.5M":"X","11.5M":"X","13M":"X"}},
            {name: "Twin Mercury F150Hp XLPT/CXLPT (incl. controls, steering, gauges)", prices: {"6.5M":"X","7.6M":34255,"8.5M":"X","9.5M":"X","11.5M":"X","13M":"X"}},
            {name: "Twin Mercury Verado F300 V8 XL/CXL (DTS, Vessel View 502)", prices: {"6.5M":"X","7.6M":"X","8.5M":68975,"9.5M":68975,"11.5M":68975,"13M":"X"}},
            {name: "Twin Mercury F400 V10 XL/CXL (DTS, Vessel View 502)", prices: {"6.5M":"X","7.6M":"X","8.5M":"X","9.5M":103120,"11.5M":103120,"13M":103120}},
            {name: "Triple Mercury Verado F300 V8 XL/CXL (DTS, Vessel View 702)", prices: {"6.5M":"X","7.6M":"X","8.5M":"X","9.5M":"X","11.5M":"X","13M":114950}},
            {name: "Triple Mercury F400 V10 XL/CXL (DTS, Vessel View 502)", prices: {"6.5M":"X","7.6M":"X","8.5M":"X","9.5M":"X","11.5M":"X","13M":166180}}
        ],
        "Customization": [
            {name: "Boat Painting", prices: {"6.5M":17000,"7.6M":20000,"8.5M":22000,"9.5M":25500,"11.5M":30000,"13M":32000}},
            {name: "Custom Color Hypalon", prices: {"6.5M":2500,"7.6M":3000,"8.5M":3500,"9.5M":4000,"11.5M":4500,"13M":5000}},
            {name: "Double Layer Hypalon", prices: {"6.5M":15340,"7.6M":17500,"8.5M":20000,"9.5M":22420,"11.5M":27000,"13M":28320}},
            {name: "Hypalon Strip Between Fender", prices: {"6.5M":5000,"7.6M":6000,"8.5M":6880,"9.5M":7700,"11.5M":9300,"13M":9720}},
            {name: "Hypalon Branding And Numbering", prices: {"6.5M":700,"7.6M":800,"8.5M":900,"9.5M":1000,"11.5M":1100,"13M":1100}},
            {name: "Extra Handle", prices: {"6.5M":250,"7.6M":250,"8.5M":250,"9.5M":250,"11.5M":250,"13M":250}},
            {name: "Diver-Notch", prices: {"6.5M":9800,"7.6M":9800,"8.5M":9800,"9.5M":9800,"11.5M":9800,"13M":9800}},
            {name: "Notch Filling Inserts", prices: {"6.5M":2500,"7.6M":2500,"8.5M":2500,"9.5M":2500,"11.5M":3500,"13M":3500}}
        ],
        "Consoles, Cabins & T-Tops": [
            {name: "Aluminium Console with Windscreen and Grab Rail", prices: {"6.5M":10115,"7.6M":10115,"8.5M":10500,"9.5M":11200,"11.5M":12000,"13M":12000}},
            {name: "Aluminum Cabin with Cuddy and Toilet", prices: {"6.5M":"X","7.6M":"X","8.5M":"X","9.5M":79570,"11.5M":79570,"13M":79570}},
            {name: "Aluminum Cabin for 4 Pax", prices: {"6.5M":"X","7.6M":"X","8.5M":"X","9.5M":"TBD","11.5M":"TBD","13M":"TBD"}},
            {name: "Aluminum Wheel-house", prices: {"6.5M":19115,"7.6M":19115,"8.5M":21000,"9.5M":21000,"11.5M":24000,"13M":24000}},
            {name: "Aluminium T-Top with Hard Top 1 (2.7m)", prices: {"6.5M":12560,"7.6M":12560,"8.5M":12560,"9.5M":12560,"11.5M":12560,"13M":12560}},
            {name: "Aluminium T-Top with Hard Top 2 (3.8m)", prices: {"6.5M":14920,"7.6M":14920,"8.5M":14920,"9.5M":14920,"11.5M":14920,"13M":14920}},
            {name: "Aluminium T-Top with Hard Top 3 (4.4m)", prices: {"6.5M":"X","7.6M":"X","8.5M":"X","9.5M":"X","11.5M":32000,"13M":32000}}
        ],
        "Seating - Leaning Posts": [
            {name: "Aluminium Leaning Post Single", prices: {"6.5M":2765,"7.6M":2765,"8.5M":2765,"9.5M":2765,"11.5M":2765,"13M":2765}},
            {name: "Aluminium Leaning Post with Back Rest Single", prices: {"6.5M":3310,"7.6M":3310,"8.5M":3310,"9.5M":3310,"11.5M":3310,"13M":3310}},
            {name: "Aluminium Leaning Post Double", prices: {"6.5M":3400,"7.6M":3400,"8.5M":3400,"9.5M":3400,"11.5M":3400,"13M":3400}},
            {name: "Aluminium Leaning Post with Back Rest Double", prices: {"6.5M":4000,"7.6M":4000,"8.5M":4000,"9.5M":4000,"11.5M":4000,"13M":4000}}
        ],
        "Seating - Jockey & Grab Rail": [
            {name: "Grab Rail for Front Seat", prices: {"6.5M":650,"7.6M":650,"8.5M":650,"9.5M":650,"11.5M":650,"13M":650}},
            {name: "Single Aluminium Jockey Seat with Grab Rail", prices: {"6.5M":1270,"7.6M":1270,"8.5M":1270,"9.5M":1270,"11.5M":1270,"13M":1270}},
            {name: "Double Aluminium Jockey Seat with Grab Rail", prices: {"6.5M":2535,"7.6M":2535,"8.5M":2535,"9.5M":2535,"11.5M":2535,"13M":2535}}
        ],
        "Seating - Suspension": [
            {name: "Ullman BISCAYA Jockey Suspension Seat", prices: {"6.5M":5500,"7.6M":5500,"8.5M":5500,"9.5M":5500,"11.5M":5500,"13M":5500}},
            {name: "Ullman Patrol Jockey Suspension Seat", prices: {"6.5M":6250,"7.6M":6250,"8.5M":6250,"9.5M":6250,"11.5M":6250,"13M":6250}},
            {name: "Echelon Midback Jockey Suspension Seat", prices: {"6.5M":16300,"7.6M":16300,"8.5M":16300,"9.5M":16300,"11.5M":16300,"13M":16300}}
        ],
        "Frames & Structure": [
            {name: "Aluminium A Frame", prices: {"6.5M":2885,"7.6M":2885,"8.5M":2885,"9.5M":2885,"11.5M":3260,"13M":3260}},
            {name: "Aluminium A Frame With Self-righting System", prices: {"6.5M":9730,"7.6M":9730,"8.5M":9730,"9.5M":9730,"11.5M":10140,"13M":10140}},
            {name: "Aluminium A Frame with Ladder", prices: {"6.5M":4300,"7.6M":4300,"8.5M":4300,"9.5M":4300,"11.5M":4675,"13M":4675}},
            {name: "Aluminium Tube Ladder", prices: {"6.5M":2500,"7.6M":2500,"8.5M":2500,"9.5M":2500,"11.5M":2500,"13M":2500}},
            {name: "Swim Platform at Transom for Inboard Engine", prices: {"6.5M":1285,"7.6M":1285,"8.5M":1285,"9.5M":1285,"11.5M":1285,"13M":1285}},
            {name: "Aluminium Bow Tow Post", prices: {"6.5M":2230,"7.6M":2230,"8.5M":2230,"9.5M":2230,"11.5M":2230,"13M":2230}},
            {name: "Aluminium Aft Tow Post", prices: {"6.5M":2230,"7.6M":2230,"8.5M":2230,"9.5M":2230,"11.5M":2230,"13M":2230}},
            {name: "Aluminium Bollard", prices: {"6.5M":835,"7.6M":835,"8.5M":835,"9.5M":835,"11.5M":835,"13M":835}},
            {name: "Bow HD Tow Post w/Weapons Mount Flange", prices: {"6.5M":7000,"7.6M":7000,"8.5M":7000,"9.5M":7000,"11.5M":7000,"13M":7000}},
            {name: "Aft HD Tow Post w/Weapons Mount Flange", prices: {"6.5M":7000,"7.6M":7000,"8.5M":7000,"9.5M":7000,"11.5M":7000,"13M":7000}}
        ],
        "Safety Equipment": [
            {name: "Bow Step with 2 Stainless Steel Cleats", prices: {"6.5M":545,"7.6M":545,"8.5M":545,"9.5M":545,"11.5M":545,"13M":545}},
            {name: "Aluminium Anchor with S.S Chain", prices: {"6.5M":1075,"7.6M":1075,"8.5M":1075,"9.5M":1075,"11.5M":1075,"13M":1075}},
            {name: "Aluminium Anchor with Rope 30m", prices: {"6.5M":390,"7.6M":390,"8.5M":390,"9.5M":390,"11.5M":390,"13M":390}},
            {name: "Windless Clipper with S.S Chain & Anchor", prices: {"6.5M":5360,"7.6M":5360,"8.5M":5360,"9.5M":5360,"11.5M":5360,"13M":5360}},
            {name: "Distress Signal Kit for Coastal Navigation", prices: {"6.5M":200,"7.6M":200,"8.5M":200,"9.5M":200,"11.5M":200,"13M":200}},
            {name: "2x Fire Extinguisher (2Kg) IAW COLREGS", prices: {"6.5M":300,"7.6M":300,"8.5M":300,"9.5M":300,"11.5M":300,"13M":300}},
            {name: "2x 20\" USCG Approved Ring Buoy IAW COLREGS", prices: {"6.5M":160,"7.6M":160,"8.5M":160,"9.5M":160,"11.5M":160,"13M":160}},
            {name: "2x Mooring Rope 12mm 20m", prices: {"6.5M":300,"7.6M":300,"8.5M":300,"9.5M":300,"11.5M":300,"13M":300}},
            {name: "2x Gunwale Mounted Boat Hook", prices: {"6.5M":150,"7.6M":150,"8.5M":150,"9.5M":150,"11.5M":150,"13M":150}},
            {name: "Forward Deck Mounted Boarding Team Hand Railing", prices: {"6.5M":5200,"7.6M":5200,"8.5M":5200,"9.5M":5200,"11.5M":5200,"13M":5200}},
            {name: "Single Hoisting Lifting System", prices: {"6.5M":19500,"7.6M":19500,"8.5M":19500,"9.5M":19500,"11.5M":19500,"13M":19500}},
            {name: "Fire Extinguisher Compartment", prices: {"6.5M":310,"7.6M":310,"8.5M":310,"9.5M":310,"11.5M":310,"13M":310}},
            {name: "Boat Cover", prices: {"6.5M":2500,"7.6M":4000,"8.5M":4500,"9.5M":5000,"11.5M":5500,"13M":5500}},
            {name: "Anti-fouling Hull Bottom Paint", prices: {"6.5M":2575,"7.6M":3140,"8.5M":3460,"9.5M":3750,"11.5M":4275,"13M":4500}},
            {name: "Life Ring", prices: {"6.5M":110,"7.6M":110,"8.5M":110,"9.5M":110,"11.5M":110,"13M":110}},
            {name: "Dive Bottle Rack (6 Bottles)", prices: {"6.5M":3250,"7.6M":3250,"8.5M":3250,"9.5M":3250,"11.5M":3250,"13M":3250}},
            {name: "Life Jacket SOLAS Foam with Flashlight 170N", prices: {"6.5M":85,"7.6M":85,"8.5M":85,"9.5M":85,"11.5M":85,"13M":85}},
            {name: "Life Jacket Manual Inflatable 170N", prices: {"6.5M":120,"7.6M":120,"8.5M":120,"9.5M":120,"11.5M":120,"13M":120}}
        ],
        "Navigation": [
            {name: "GARMIN GPSMAP 923 XSV 9\" MFD with Sonar", prices: {"6.5M":2270,"7.6M":2270,"8.5M":2270,"9.5M":2270,"11.5M":2270,"13M":2270}},
            {name: "GARMIN GPSMAP 8410 XSV 10\" MFD with Sonar", prices: {"6.5M":4400,"7.6M":4400,"8.5M":4400,"9.5M":4400,"11.5M":4400,"13M":4400}},
            {name: "GARMIN GPSMAP 8410 10\" MFD W/O Sonar", prices: {"6.5M":3500,"7.6M":3500,"8.5M":3500,"9.5M":3500,"11.5M":3500,"13M":3500}},
            {name: "GARMIN GMR 18HD+ 18NM Radar Scanner", prices: {"6.5M":2200,"7.6M":2200,"8.5M":2200,"9.5M":2200,"11.5M":2200,"13M":2200}},
            {name: "GARMIN GMR Fantom 18x Dome Radar", prices: {"6.5M":2600,"7.6M":2600,"8.5M":2600,"9.5M":2600,"11.5M":2600,"13M":2600}}
        ],
        "Communication": [
            {name: "Garmin 115i VHF Radio with Antenna", prices: {"6.5M":750,"7.6M":750,"8.5M":750,"9.5M":750,"11.5M":750,"13M":750}},
            {name: "Garmin 215i AIS VHF Radio with Antenna", prices: {"6.5M":1200,"7.6M":1200,"8.5M":1200,"9.5M":1200,"11.5M":1200,"13M":1200}},
            {name: "Whelen Siren/PA System IAW COLREGS", prices: {"6.5M":1100,"7.6M":1100,"8.5M":1100,"9.5M":1100,"11.5M":1100,"13M":1100}},
            {name: "Signal Horn 12VDC IAW COLREGS", prices: {"6.5M":250,"7.6M":250,"8.5M":250,"9.5M":250,"11.5M":250,"13M":250}}
        ],
        "Lighting & Electrical": [
            {name: "FLIR M232 Thermal Camera (320x240, 9Hz)", prices: {"6.5M":6500,"7.6M":6500,"8.5M":6500,"9.5M":6500,"11.5M":6500,"13M":6500}},
            {name: "FLIR M364C Gyro Stabilized Thermal IP Camera", prices: {"6.5M":27000,"7.6M":27000,"8.5M":27000,"9.5M":27000,"11.5M":27000,"13M":27000}},
            {name: "STL K-FORCE LED Law Enforcement Light Bar", prices: {"6.5M":1500,"7.6M":1500,"8.5M":1500,"9.5M":1500,"11.5M":1500,"13M":1500}},
            {name: "Remote Search Light ACR RCL 95 w/Joystick", prices: {"6.5M":1050,"7.6M":1050,"8.5M":1050,"9.5M":1050,"11.5M":1050,"13M":1050}},
            {name: "LED Flood Lights / Scene-Lights (4 pieces)", prices: {"6.5M":800,"7.6M":800,"8.5M":800,"9.5M":800,"11.5M":800,"13M":800}},
            {name: "Deck Light LED Tri-Color Lighting", prices: {"6.5M":1060,"7.6M":1060,"8.5M":1400,"9.5M":1400,"11.5M":1775,"13M":1775}},
            {name: "12 VDC Air-Compressor Tube Inflation System", prices: {"6.5M":400,"7.6M":400,"8.5M":400,"9.5M":400,"11.5M":400,"13M":400}},
            {name: "3-Bank Onboard Battery Charging System 40A", prices: {"6.5M":750,"7.6M":750,"8.5M":750,"9.5M":750,"11.5M":750,"13M":750}},
            {name: "BLUE SEA Accessory Receptacle 12VDC", prices: {"6.5M":75,"7.6M":75,"8.5M":75,"9.5M":75,"11.5M":75,"13M":75}},
            {name: "BLUE SEA 12VDC Dual USB Charging Outlets", prices: {"6.5M":100,"7.6M":100,"8.5M":100,"9.5M":100,"11.5M":100,"13M":100}},
            {name: "Plastimo Flush Mount Offshore Compass 95", prices: {"6.5M":380,"7.6M":380,"8.5M":380,"9.5M":380,"11.5M":380,"13M":380}}
        ],
        "Protection & Guards": [
            {name: "Aluminium Bow Guard with Pushing Knee", prices: {"6.5M":8110,"7.6M":8110,"8.5M":8110,"9.5M":8110,"11.5M":8110,"13M":8110}},
            {name: "PE Filled Foam - Pushing Knee", prices: {"6.5M":4400,"7.6M":4400,"8.5M":4400,"9.5M":4400,"11.5M":4400,"13M":4400}},
            {name: "HD Aluminium Engine Guard", prices: {"6.5M":2800,"7.6M":2800,"8.5M":2800,"9.5M":2800,"11.5M":2800,"13M":2800}},
            {name: "Propeller Guard", prices: {"6.5M":1680,"7.6M":1680,"8.5M":1680,"9.5M":1680,"11.5M":1680,"13M":1680}},
            {name: "Wooden Pallet with Shrink-Wrap Packaging", prices: {"6.5M":1430,"7.6M":1430,"8.5M":1430,"9.5M":1430,"11.5M":1430,"13M":1430}}
        ]
    },
    fiberglass: {
        "Propulsion / Engine": [
            {name: "Single Mercury F150Hp EXLPT (incl. controls, steering, gauges)", prices: {"4.1M":18620,"5.1M":"X","5.5M":"X","6.5M":"X","7.2M":"X","8.0M":"X","8.5M":"X","9.5M":"X","12M":"X"}},
            {name: "Twin Mercury F150Hp XLPT/CXLPT (incl. controls, steering, gauges)", prices: {"4.1M":"X","5.1M":34255,"5.5M":"X","6.5M":"X","7.2M":"X","8.0M":"X","8.5M":"X","9.5M":"X","12M":"X"}},
            {name: "Twin Mercury Verado F300 V8 XL/CXL (DTS, Vessel View 502)", prices: {"4.1M":"X","5.1M":"X","5.5M":68975,"6.5M":68975,"7.2M":68975,"8.0M":"X","8.5M":"X","9.5M":"X","12M":"X"}},
            {name: "Twin Mercury F400 V10 XL/CXL (DTS, Vessel View 502)", prices: {"4.1M":"X","5.1M":"X","5.5M":"X","6.5M":103120,"7.2M":103120,"8.0M":103120,"8.5M":103120,"9.5M":103120,"12M":103120}},
            {name: "Triple Mercury Verado F300 V8 XL/CXL (DTS, Vessel View 702)", prices: {"4.1M":"X","5.1M":"X","5.5M":"X","6.5M":"X","7.2M":"X","8.0M":114950,"8.5M":114950,"9.5M":114950,"12M":114950}},
            {name: "Triple Mercury F400 V10 XL/CXL (DTS, Vessel View 502)", prices: {"4.1M":"X","5.1M":"X","5.5M":"X","6.5M":"X","7.2M":"X","8.0M":166180,"8.5M":166180,"9.5M":166180,"12M":166180}}
        ],
        "Customization": [
            {name: "Hybrid Foam-Filled Tube-Set", prices: {"4.1M":9880,"5.1M":12010,"5.5M":12955,"6.5M":15310,"7.2M":16960,"8.0M":18840,"8.5M":20608,"9.5M":22375,"12M":29300}},
            {name: "Custom Color Hypalon", prices: {"4.1M":2500,"5.1M":3000,"5.5M":3500,"6.5M":4000,"7.2M":4500,"8.0M":5000,"8.5M":5000,"9.5M":5000,"12M":5000}},
            {name: "Double Layer Hypalon", prices: {"4.1M":15340,"5.1M":17500,"5.5M":20000,"6.5M":22420,"7.2M":27000,"8.0M":28320,"8.5M":28320,"9.5M":28320,"12M":28320}},
            {name: "Hypalon Strip Between Fender", prices: {"4.1M":2000,"5.1M":2200,"5.5M":2400,"6.5M":2600,"7.2M":2800,"8.0M":3000,"8.5M":3100,"9.5M":3300,"12M":3500}},
            {name: "Hypalon Non-Slip Step-Tread", prices: {"4.1M":1500,"5.1M":1700,"5.5M":2200,"6.5M":2500,"7.2M":2800,"8.0M":3000,"8.5M":3100,"9.5M":3200,"12M":3300}},
            {name: "Hypalon Branding And Numbering", prices: {"4.1M":700,"5.1M":700,"5.5M":700,"6.5M":700,"7.2M":700,"8.0M":700,"8.5M":700,"9.5M":700,"12M":700}},
            {name: "Extra Handle", prices: {"4.1M":50,"5.1M":50,"5.5M":50,"6.5M":50,"7.2M":50,"8.0M":50,"8.5M":50,"9.5M":50,"12M":50}},
            {name: "Diver-Notch", prices: {"4.1M":3200,"5.1M":3200,"5.5M":3200,"6.5M":3200,"7.2M":3200,"8.0M":3200,"8.5M":3200,"9.5M":3200,"12M":3200}},
            {name: "Notch Filling Inserts", prices: {"4.1M":2500,"5.1M":2500,"5.5M":2500,"6.5M":2500,"7.2M":3500,"8.0M":3500,"8.5M":3500,"9.5M":3500,"12M":3500}}
        ],
        "Consoles, Cabins & T-Tops": [
            {name: "Single Futura Console with Forward Seat", prices: {"4.1M":"X","5.1M":4610,"5.5M":4610,"6.5M":4610,"7.2M":4610,"8.0M":4610,"8.5M":4610,"9.5M":4610,"12M":4610}},
            {name: "Single Futura Console without Forward Seat", prices: {"4.1M":"X","5.1M":3647,"5.5M":3647,"6.5M":3647,"7.2M":3647,"8.0M":3647,"8.5M":3647,"9.5M":3647,"12M":3647}},
            {name: "Double Futura Console with Forward Seat - Low Rail", prices: {"4.1M":"X","5.1M":"X","5.5M":"X","6.5M":6380,"7.2M":6380,"8.0M":6380,"8.5M":6380,"9.5M":6380,"12M":6380}},
            {name: "Double Futura Console with Forward Seat - High Rail", prices: {"4.1M":"X","5.1M":"X","5.5M":"X","6.5M":8390,"7.2M":8390,"8.0M":8390,"8.5M":8390,"9.5M":8390,"12M":8390}},
            {name: "Double Futura Console without Forward Seat - Low Rail", prices: {"4.1M":"X","5.1M":"X","5.5M":"X","6.5M":4950,"7.2M":4950,"8.0M":4950,"8.5M":4950,"9.5M":4950,"12M":4950}},
            {name: "Double Futura Console without Forward Seat - High Rail", prices: {"4.1M":"X","5.1M":"X","5.5M":"X","6.5M":6960,"7.2M":6960,"8.0M":6960,"8.5M":6960,"9.5M":6960,"12M":6960}},
            {name: "Aluminium Console with Windscreen and Grab Rail", prices: {"4.1M":10115,"5.1M":10115,"5.5M":10500,"6.5M":11200,"7.2M":12000,"8.0M":12000,"8.5M":12000,"9.5M":12800,"12M":12800}},
            {name: "Double Ballistic Console", prices: {"4.1M":"X","5.1M":"X","5.5M":"X","6.5M":5840,"7.2M":5840,"8.0M":5840,"8.5M":5840,"9.5M":5840,"12M":5840}},
            {name: "Double Console with Toilet", prices: {"4.1M":"X","5.1M":"X","5.5M":"X","6.5M":"X","7.2M":"X","8.0M":23570,"8.5M":23570,"9.5M":23570,"12M":23570}},
            {name: "Beachlander Console", prices: {"4.1M":"X","5.1M":2590,"5.5M":2590,"6.5M":2590,"7.2M":2590,"8.0M":2590,"8.5M":2590,"9.5M":2590,"12M":2590}},
            {name: "Jockey Seat Console", prices: {"4.1M":3480,"5.1M":3480,"5.5M":3480,"6.5M":3480,"7.2M":3480,"8.0M":3480,"8.5M":3480,"9.5M":3480,"12M":3480}},
            {name: "Mamba Console", prices: {"4.1M":"X","5.1M":3290,"5.5M":3290,"6.5M":"X","7.2M":"X","8.0M":"X","8.5M":"X","9.5M":"X","12M":"X"}},
            {name: "Aluminum Cabin for 4 PAX", prices: {"4.1M":"X","5.1M":"X","5.5M":"X","6.5M":"TBD","7.2M":"TBD","8.0M":"TBD","8.5M":"TBD","9.5M":"TBD","12M":"TBD"}},
            {name: "Aluminum Cabin with Cuddy and Toilet", prices: {"4.1M":"X","5.1M":"X","5.5M":"X","6.5M":"X","7.2M":"X","8.0M":"X","8.5M":"X","9.5M":79570,"12M":79570}},
            {name: "Aluminum Wheel-house", prices: {"4.1M":"X","5.1M":"X","5.5M":"X","6.5M":"X","7.2M":"X","8.0M":19200,"8.5M":19200,"9.5M":19200,"12M":19200}},
            {name: "Standard HD T-Top", prices: {"4.1M":"X","5.1M":8300,"5.5M":8300,"6.5M":8300,"7.2M":8300,"8.0M":8300,"8.5M":8300,"9.5M":8300,"12M":8300}},
            {name: "S.S. HD T-Top", prices: {"4.1M":"X","5.1M":13250,"5.5M":13250,"6.5M":13250,"7.2M":13250,"8.0M":13250,"8.5M":13250,"9.5M":13250,"12M":13250}},
            {name: "Aluminium T-Top with Hard Top 1 (2.7m)", prices: {"4.1M":12560,"5.1M":12560,"5.5M":12560,"6.5M":12560,"7.2M":12560,"8.0M":12560,"8.5M":12560,"9.5M":12560,"12M":12560}},
            {name: "Aluminium T-Top with Hard Top 2 (3.8m)", prices: {"4.1M":14920,"5.1M":14920,"5.5M":14920,"6.5M":14920,"7.2M":14920,"8.0M":14920,"8.5M":14920,"9.5M":14920,"12M":14920}},
            {name: "Aluminium T-Top with Hard Top 3 (4.4m)", prices: {"4.1M":"X","5.1M":"X","5.5M":"X","6.5M":"X","7.2M":26100,"8.0M":26100,"8.5M":26100,"9.5M":26100,"12M":26100}},
            {name: "Aluminium Foldable T-Top", prices: {"4.1M":"X","5.1M":10615,"5.5M":10615,"6.5M":10615,"7.2M":10615,"8.0M":10615,"8.5M":10615,"9.5M":10615,"12M":10615}},
            {name: "Extended Canopy to A-Frame", prices: {"4.1M":"X","5.1M":655,"5.5M":655,"6.5M":655,"7.2M":655,"8.0M":655,"8.5M":655,"9.5M":655,"12M":655}}
        ],
        "Seating - Leaning Posts": [
            {name: "Leaning Post Single", prices: {"4.1M":"X","5.1M":2765,"5.5M":2765,"6.5M":2765,"7.2M":2765,"8.0M":2765,"8.5M":2765,"9.5M":2765,"12M":2765}},
            {name: "Leaning Post with Back Rest Single", prices: {"4.1M":"X","5.1M":3310,"5.5M":3310,"6.5M":3310,"7.2M":3310,"8.0M":3310,"8.5M":3310,"9.5M":3310,"12M":3310}},
            {name: "Leaning Post Double", prices: {"4.1M":"X","5.1M":3400,"5.5M":3400,"6.5M":3400,"7.2M":3400,"8.0M":3400,"8.5M":3400,"9.5M":3400,"12M":3400}},
            {name: "Leaning Post With Back Rest Double", prices: {"4.1M":"X","5.1M":4000,"5.5M":4000,"6.5M":4000,"7.2M":4000,"8.0M":4000,"8.5M":4000,"9.5M":4000,"12M":4000}},
            {name: "Fiber Glass Leaning Post with Back Rest - Single", prices: {"4.1M":"X","5.1M":"X","5.5M":9000,"6.5M":9000,"7.2M":9000,"8.0M":9000,"8.5M":9000,"9.5M":9000,"12M":9000}}
        ],
        "Seating - Jockey & Straddle": [
            {name: "Grab Rail for Front Seat", prices: {"4.1M":650,"5.1M":650,"5.5M":650,"6.5M":650,"7.2M":650,"8.0M":650,"8.5M":650,"9.5M":650,"12M":650}},
            {name: "Straddle Seat with Handle", prices: {"4.1M":1980,"5.1M":1980,"5.5M":1980,"6.5M":1980,"7.2M":1980,"8.0M":1980,"8.5M":1980,"9.5M":1980,"12M":1980}},
            {name: "Single GRP Jockey Seat with Back Rail", prices: {"4.1M":1700,"5.1M":1700,"5.5M":1700,"6.5M":1700,"7.2M":1700,"8.0M":1700,"8.5M":1700,"9.5M":1700,"12M":1700}},
            {name: "Double GRP Jockey Seat with Back Rail", prices: {"4.1M":3400,"5.1M":3400,"5.5M":3400,"6.5M":3400,"7.2M":3400,"8.0M":3400,"8.5M":3400,"9.5M":3400,"12M":3400}}
        ],
        "Seating - Bench Seats": [
            {name: "Painted Aluminum Bench Seat 1 PAX with Storage", prices: {"4.1M":4420,"5.1M":4420,"5.5M":4420,"6.5M":4420,"7.2M":4420,"8.0M":4420,"8.5M":4420,"9.5M":4420,"12M":4420}},
            {name: "S.S. Bench Seat 1 PAX with Storage", prices: {"4.1M":5530,"5.1M":5530,"5.5M":5530,"6.5M":5530,"7.2M":5530,"8.0M":5530,"8.5M":5530,"9.5M":5530,"12M":5530}},
            {name: "Painted Aluminum Bench Seat 2 PAX with Storage", prices: {"4.1M":5150,"5.1M":5150,"5.5M":5150,"6.5M":5150,"7.2M":5150,"8.0M":5150,"8.5M":5150,"9.5M":5150,"12M":5150}},
            {name: "S.S. Bench Seat 2 PAX with Storage", prices: {"4.1M":6240,"5.1M":6240,"5.5M":6240,"6.5M":6240,"7.2M":6240,"8.0M":6240,"8.5M":6240,"9.5M":6240,"12M":6240}},
            {name: "Painted Aluminum Bench Seat 3 PAX with Storage", prices: {"4.1M":6570,"5.1M":6570,"5.5M":6570,"6.5M":6570,"7.2M":6570,"8.0M":6570,"8.5M":6570,"9.5M":6570,"12M":6570}},
            {name: "S.S. Bench Seat 3 PAX with Storage", prices: {"4.1M":7890,"5.1M":7890,"5.5M":7890,"6.5M":7890,"7.2M":7890,"8.0M":7890,"8.5M":7890,"9.5M":7890,"12M":7890}},
            {name: "Painted Aluminum Bench Seat 4 PAX with Storage", prices: {"4.1M":8360,"5.1M":8360,"5.5M":8360,"6.5M":8360,"7.2M":8360,"8.0M":8360,"8.5M":8360,"9.5M":8360,"12M":8360}},
            {name: "S.S. Bench Seat 4 PAX with Storage", prices: {"4.1M":8350,"5.1M":8350,"5.5M":8350,"6.5M":8350,"7.2M":8350,"8.0M":8350,"8.5M":8350,"9.5M":8350,"12M":8350}}
        ],
        "Seating - Suspension": [
            {name: "Ullman BISCAYA Jockey Suspension Seat", prices: {"4.1M":5500,"5.1M":5500,"5.5M":5500,"6.5M":5500,"7.2M":5500,"8.0M":5500,"8.5M":5500,"9.5M":5500,"12M":5500}},
            {name: "Ullman Patrol Jockey Suspension Seat", prices: {"4.1M":6250,"5.1M":6250,"5.5M":6250,"6.5M":6250,"7.2M":6250,"8.0M":6250,"8.5M":6250,"9.5M":6250,"12M":6250}},
            {name: "Echelon Midback Jockey Suspension Seat", prices: {"4.1M":16300,"5.1M":16300,"5.5M":16300,"6.5M":16300,"7.2M":16300,"8.0M":16300,"8.5M":16300,"9.5M":16300,"12M":16300}}
        ],
        "Frames & Structure": [
            {name: "Aluminium A Frame", prices: {"4.1M":2885,"5.1M":2885,"5.5M":2885,"6.5M":2885,"7.2M":3260,"8.0M":3260,"8.5M":3400,"9.5M":3400,"12M":3600}},
            {name: "Aluminium A Frame With Self-righting System", prices: {"4.1M":9730,"5.1M":9730,"5.5M":9730,"6.5M":9730,"7.2M":10140,"8.0M":10140,"8.5M":10500,"9.5M":10500,"12M":10800}},
            {name: "Aluminium A Frame with Swim Platform and Ladder", prices: {"4.1M":4300,"5.1M":4300,"5.5M":4300,"6.5M":4300,"7.2M":4675,"8.0M":4675,"8.5M":4800,"9.5M":4800,"12M":5000}},
            {name: "Aluminium Tube Ladder", prices: {"4.1M":2500,"5.1M":2500,"5.5M":2500,"6.5M":2500,"7.2M":2500,"8.0M":2500,"8.5M":2500,"9.5M":2500,"12M":2500}},
            {name: "Swim Platform at Transom for Inboard Engine", prices: {"4.1M":1285,"5.1M":1285,"5.5M":1285,"6.5M":1285,"7.2M":1285,"8.0M":1285,"8.5M":1285,"9.5M":1285,"12M":1285}},
            {name: "Bow Tow Post", prices: {"4.1M":2230,"5.1M":2230,"5.5M":2230,"6.5M":2230,"7.2M":2230,"8.0M":2230,"8.5M":2230,"9.5M":2230,"12M":2230}},
            {name: "Aft Tow Post", prices: {"4.1M":2230,"5.1M":2230,"5.5M":2230,"6.5M":2230,"7.2M":2230,"8.0M":2230,"8.5M":2230,"9.5M":2230,"12M":2230}},
            {name: "Bollard", prices: {"4.1M":835,"5.1M":835,"5.5M":835,"6.5M":835,"7.2M":835,"8.0M":835,"8.5M":835,"9.5M":835,"12M":835}},
            {name: "Bow HD Tow Post w/Weapons Mount Flange", prices: {"4.1M":7000,"5.1M":7000,"5.5M":7000,"6.5M":7000,"7.2M":7000,"8.0M":7000,"8.5M":7000,"9.5M":7000,"12M":7000}},
            {name: "Aft HD Tow Post w/Weapons Mount Flange", prices: {"4.1M":7000,"5.1M":7000,"5.5M":7000,"6.5M":7000,"7.2M":7000,"8.0M":7000,"8.5M":7000,"9.5M":7000,"12M":7000}}
        ],
        "Safety Equipment": [
            {name: "Bow Step with 2 Stainless Steel Cleats", prices: {"4.1M":545,"5.1M":545,"5.5M":545,"6.5M":545,"7.2M":545,"8.0M":545,"8.5M":545,"9.5M":545,"12M":545}},
            {name: "Aluminium Anchor with S.S Chain", prices: {"4.1M":1075,"5.1M":1075,"5.5M":1075,"6.5M":1075,"7.2M":1075,"8.0M":1075,"8.5M":1075,"9.5M":1075,"12M":1075}},
            {name: "Aluminium Anchor with Rope 30m", prices: {"4.1M":390,"5.1M":390,"5.5M":390,"6.5M":390,"7.2M":390,"8.0M":390,"8.5M":390,"9.5M":390,"12M":390}},
            {name: "Windless Clipper with S.S Chain & Anchor", prices: {"4.1M":5360,"5.1M":5360,"5.5M":5360,"6.5M":5360,"7.2M":5360,"8.0M":5360,"8.5M":5360,"9.5M":5360,"12M":5360}},
            {name: "Distress Signal Kit for Coastal Navigation", prices: {"4.1M":200,"5.1M":200,"5.5M":200,"6.5M":200,"7.2M":200,"8.0M":200,"8.5M":200,"9.5M":200,"12M":200}},
            {name: "2x Fire Extinguisher (2Kg) IAW COLREGS", prices: {"4.1M":300,"5.1M":300,"5.5M":300,"6.5M":300,"7.2M":300,"8.0M":300,"8.5M":300,"9.5M":300,"12M":300}},
            {name: "2x 20\" USCG Approved Ring Buoy IAW COLREGS", prices: {"4.1M":160,"5.1M":160,"5.5M":160,"6.5M":160,"7.2M":160,"8.0M":160,"8.5M":160,"9.5M":160,"12M":160}},
            {name: "2x Mooring Rope 12mm 20m", prices: {"4.1M":300,"5.1M":300,"5.5M":300,"6.5M":300,"7.2M":300,"8.0M":300,"8.5M":300,"9.5M":300,"12M":300}},
            {name: "2x Gunwale Mounted Boat Hook", prices: {"4.1M":150,"5.1M":150,"5.5M":150,"6.5M":150,"7.2M":150,"8.0M":150,"8.5M":150,"9.5M":150,"12M":150}},
            {name: "Single Hoisting Lifting System", prices: {"4.1M":15000,"5.1M":15000,"5.5M":15000,"6.5M":15000,"7.2M":19500,"8.0M":19500,"8.5M":19500,"9.5M":19500,"12M":19500}},
            {name: "Boat Cover", prices: {"4.1M":2500,"5.1M":4000,"5.5M":4500,"6.5M":5000,"7.2M":5500,"8.0M":5500,"8.5M":5500,"9.5M":5500,"12M":5500}},
            {name: "Anti-fouling Hull Bottom Paint", prices: {"4.1M":2575,"5.1M":3140,"5.5M":3460,"6.5M":3750,"7.2M":4275,"8.0M":4500,"8.5M":4500,"9.5M":4500,"12M":4500}},
            {name: "Life Ring", prices: {"4.1M":110,"5.1M":110,"5.5M":110,"6.5M":110,"7.2M":110,"8.0M":110,"8.5M":110,"9.5M":110,"12M":110}},
            {name: "Dive Bottle Rack (6 Bottles)", prices: {"4.1M":3250,"5.1M":3250,"5.5M":3250,"6.5M":3250,"7.2M":3250,"8.0M":3250,"8.5M":3250,"9.5M":3250,"12M":3250}},
            {name: "Life Jacket SOLAS Foam with Flashlight 170N", prices: {"4.1M":85,"5.1M":85,"5.5M":85,"6.5M":85,"7.2M":85,"8.0M":85,"8.5M":85,"9.5M":85,"12M":85}},
            {name: "Life Jacket Manual Inflatable 170N", prices: {"4.1M":120,"5.1M":120,"5.5M":120,"6.5M":120,"7.2M":120,"8.0M":120,"8.5M":120,"9.5M":120,"12M":120}}
        ],
        "Navigation": [
            {name: "GARMIN GPSMAP 923 XSV 9\" MFD with Sonar", prices: {"4.1M":2270,"5.1M":2270,"5.5M":2270,"6.5M":2270,"7.2M":2270,"8.0M":2270,"8.5M":2270,"9.5M":2270,"12M":2270}},
            {name: "GARMIN GPSMAP 8410 XSV 10\" MFD with Sonar", prices: {"4.1M":4400,"5.1M":4400,"5.5M":4400,"6.5M":4400,"7.2M":4400,"8.0M":4400,"8.5M":4400,"9.5M":4400,"12M":4400}},
            {name: "GARMIN GPSMAP 8410 10\" MFD W/O Sonar", prices: {"4.1M":3500,"5.1M":3500,"5.5M":3500,"6.5M":3500,"7.2M":3500,"8.0M":3500,"8.5M":3500,"9.5M":3500,"12M":3500}},
            {name: "GARMIN GMR 18HD+ 18NM Radar Scanner", prices: {"4.1M":2200,"5.1M":2200,"5.5M":2200,"6.5M":2200,"7.2M":2200,"8.0M":2200,"8.5M":2200,"9.5M":2200,"12M":2200}},
            {name: "GARMIN GMR Fantom 18x Dome Radar", prices: {"4.1M":2600,"5.1M":2600,"5.5M":2600,"6.5M":2600,"7.2M":2600,"8.0M":2600,"8.5M":2600,"9.5M":2600,"12M":2600}}
        ],
        "Communication": [
            {name: "Garmin 115i VHF Radio with Antenna", prices: {"4.1M":750,"5.1M":750,"5.5M":750,"6.5M":750,"7.2M":750,"8.0M":750,"8.5M":750,"9.5M":750,"12M":750}},
            {name: "Garmin 215i AIS VHF Radio with Antenna", prices: {"4.1M":1200,"5.1M":1200,"5.5M":1200,"6.5M":1200,"7.2M":1200,"8.0M":1200,"8.5M":1200,"9.5M":1200,"12M":1200}},
            {name: "Whelen Siren/PA System IAW COLREGS", prices: {"4.1M":1100,"5.1M":1100,"5.5M":1100,"6.5M":1100,"7.2M":1100,"8.0M":1100,"8.5M":1100,"9.5M":1100,"12M":1100}},
            {name: "Signal Horn 12VDC IAW COLREGS", prices: {"4.1M":250,"5.1M":250,"5.5M":250,"6.5M":250,"7.2M":250,"8.0M":250,"8.5M":250,"9.5M":250,"12M":250}}
        ],
        "Lighting & Electrical": [
            {name: "FLIR M232 Thermal Camera (320x240, 9Hz)", prices: {"4.1M":6500,"5.1M":6500,"5.5M":6500,"6.5M":6500,"7.2M":6500,"8.0M":6500,"8.5M":6500,"9.5M":6500,"12M":6500}},
            {name: "FLIR M364C Gyro Stabilized Thermal IP Camera", prices: {"4.1M":27000,"5.1M":27000,"5.5M":27000,"6.5M":27000,"7.2M":27000,"8.0M":27000,"8.5M":27000,"9.5M":27000,"12M":27000}},
            {name: "STL K-FORCE LED Law Enforcement Light Bar", prices: {"4.1M":1500,"5.1M":1500,"5.5M":1500,"6.5M":1500,"7.2M":1500,"8.0M":1500,"8.5M":1500,"9.5M":1500,"12M":1500}},
            {name: "Remote Search Light ACR RCL 95 w/Joystick", prices: {"4.1M":1050,"5.1M":1050,"5.5M":1050,"6.5M":1050,"7.2M":1050,"8.0M":1050,"8.5M":1050,"9.5M":1050,"12M":1050}},
            {name: "LED Flood Lights / Scene-Lights (4 pieces)", prices: {"4.1M":800,"5.1M":800,"5.5M":800,"6.5M":800,"7.2M":800,"8.0M":800,"8.5M":800,"9.5M":800,"12M":800}},
            {name: "Deck Light LED Tri-Color Lighting", prices: {"4.1M":1060,"5.1M":1060,"5.5M":1400,"6.5M":1400,"7.2M":1775,"8.0M":1775,"8.5M":1775,"9.5M":1775,"12M":1775}},
            {name: "12 VDC Air-Compressor Tube Inflation System", prices: {"4.1M":400,"5.1M":400,"5.5M":400,"6.5M":400,"7.2M":400,"8.0M":400,"8.5M":400,"9.5M":400,"12M":400}},
            {name: "3-Bank Onboard Battery Charging System 40A", prices: {"4.1M":750,"5.1M":750,"5.5M":750,"6.5M":750,"7.2M":750,"8.0M":750,"8.5M":750,"9.5M":750,"12M":750}},
            {name: "BLUE SEA Accessory Receptacle 12VDC", prices: {"4.1M":75,"5.1M":75,"5.5M":75,"6.5M":75,"7.2M":75,"8.0M":75,"8.5M":75,"9.5M":75,"12M":75}},
            {name: "BLUE SEA 12VDC Dual USB Charging Outlets", prices: {"4.1M":100,"5.1M":100,"5.5M":100,"6.5M":100,"7.2M":100,"8.0M":100,"8.5M":100,"9.5M":100,"12M":100}},
            {name: "Plastimo Flush Mount Offshore Compass 95", prices: {"4.1M":380,"5.1M":380,"5.5M":380,"6.5M":380,"7.2M":380,"8.0M":380,"8.5M":380,"9.5M":380,"12M":380}}
        ],
        "Protection & Guards": [
            {name: "Aluminium Bow Guard with Pushing Knee", prices: {"4.1M":8110,"5.1M":8110,"5.5M":8110,"6.5M":8110,"7.2M":8110,"8.0M":8110,"8.5M":8110,"9.5M":8110,"12M":8110}},
            {name: "Foam Filled Pushing Knee", prices: {"4.1M":4400,"5.1M":4400,"5.5M":4400,"6.5M":4400,"7.2M":4400,"8.0M":4400,"8.5M":4400,"9.5M":4400,"12M":4400}},
            {name: "Keel Guard", prices: {"4.1M":1430,"5.1M":1430,"5.5M":1430,"6.5M":1430,"7.2M":1430,"8.0M":1430,"8.5M":1430,"9.5M":1430,"12M":1430}},
            {name: "Full Length Keel Guard (Bow Eyes to Transom)", prices: {"4.1M":2600,"5.1M":2600,"5.5M":3000,"6.5M":3000,"7.2M":3500,"8.0M":3500,"8.5M":3500,"9.5M":3500,"12M":3500}},
            {name: "HD Aluminium Engine Guard", prices: {"4.1M":3360,"5.1M":3360,"5.5M":3360,"6.5M":3360,"7.2M":3360,"8.0M":3360,"8.5M":3360,"9.5M":3360,"12M":3360}},
            {name: "Propeller Guard", prices: {"4.1M":1680,"5.1M":1680,"5.5M":1680,"6.5M":1680,"7.2M":1680,"8.0M":1680,"8.5M":1680,"9.5M":1680,"12M":1680}},
            {name: "Wooden Pallet with Shrink-Wrap Packaging", prices: {"4.1M":1430,"5.1M":1430,"5.5M":1430,"6.5M":1430,"7.2M":1430,"8.0M":1430,"8.5M":1430,"9.5M":1430,"12M":1430}}
        ]
    },
    inflatable: {
        "Optional Accessories": [
            {name: "Custom Color Hypalon", prices: {"2.8M":"TBD","3.2M":"TBD","3.5M":"TBD","4.2M":"TBD","4.8M":"TBD","5.1M":"TBD"}},
            {name: "Extra Bench Seat", prices: {"2.8M":650,"3.2M":700,"3.5M":730,"4.2M":990,"4.8M":990,"5.1M":990}},
            {name: "Extra Hypalon D-ring Patch", prices: {"2.8M":50,"3.2M":50,"3.5M":50,"4.2M":50,"4.8M":50,"5.1M":50}},
            {name: "Hypalon Pilot Handles", prices: {"2.8M":50,"3.2M":50,"3.5M":50,"4.2M":50,"4.8M":50,"5.1M":50}},
            {name: "Moulded Rubber Handles", prices: {"2.8M":250,"3.2M":250,"3.5M":250,"4.2M":250,"4.8M":250,"5.1M":250}}
        ]
    }
};

// Category groupings - maps subcategories to main groups
// flat: true means show category directly without group wrapper
const CATEGORY_GROUPS = {
    aluminum: [
        {
            name: "Propulsion / Engine",
            icon: "‚öôÔ∏è",
            flat: true,
            categories: ["Propulsion / Engine"]
        },
        {
            name: "ASIS Accessories",
            icon: "üõ†Ô∏è",
            categories: ["Customization", "Consoles, Cabins & T-Tops", "Frames & Structure", "Safety Equipment", "Protection & Guards"],
            subgroups: [
                {
                    name: "Seating",
                    categories: ["Seating - Leaning Posts", "Seating - Jockey & Grab Rail", "Seating - Suspension"]
                }
            ]
        },
        {
            name: "Electronics & Communication",
            icon: "üì°",
            categories: ["Navigation", "Communication", "Lighting & Electrical"]
        }
    ],
    fiberglass: [
        {
            name: "Propulsion / Engine",
            icon: "‚öôÔ∏è",
            flat: true,
            categories: ["Propulsion / Engine"]
        },
        {
            name: "ASIS Accessories",
            icon: "üõ†Ô∏è",
            categories: ["Customization", "Consoles, Cabins & T-Tops", "Frames & Structure", "Safety Equipment", "Protection & Guards"],
            subgroups: [
                {
                    name: "Seating",
                    categories: ["Seating - Leaning Posts", "Seating - Jockey & Straddle", "Seating - Bench Seats", "Seating - Suspension"]
                }
            ]
        },
        {
            name: "Electronics & Communication",
            icon: "üì°",
            categories: ["Navigation", "Communication", "Lighting & Electrical"]
        }
    ],
    inflatable: [
        {
            name: "ASIS Accessories",
            icon: "üõ†Ô∏è",
            flat: true,
            categories: ["Optional Accessories"]
        }
    ]
};

// Currency rates - AED fixed, EUR fetched from API
let RATES = {USD: 1, AED: 3.6725, EUR: 0.92}; // AED fixed, EUR fallback
let ratesLoaded = false;

// Update rate info display
function updateRateInfo() {
    const infoText = `1 USD = 3.6725 AED (fixed) | ${RATES.EUR.toFixed(4)} EUR ${ratesLoaded ? '(live)' : '(fallback)'}`;
    
    const rateInfo1 = document.getElementById('rateInfo1');
    const rateInfo2 = document.getElementById('rateInfo2');
    if (rateInfo1) rateInfo1.innerHTML = ratesLoaded ? `üü¢ ${infoText}` : `üü° ${infoText}`;
    if (rateInfo2) rateInfo2.innerHTML = ratesLoaded ? `üü¢ ${infoText}` : `üü° ${infoText}`;
}

// Fetch live EUR exchange rate on page load
async function fetchExchangeRates() {
    try {
        const response = await fetch('https://api.frankfurter.app/latest?from=USD&to=EUR');
        const data = await response.json();
        RATES.EUR = data.rates.EUR;
        ratesLoaded = true;
        console.log('Live EUR rate loaded:', RATES.EUR);
        updateRateInfo();
        updateTotals();
    } catch (error) {
        console.warn('Could not fetch live EUR rate, using fallback:', error);
        updateRateInfo();
    }
}

// Call on page load
fetchExchangeRates();

// Salesman contact information
const SALESMEN = {
    mario: {
        name: "Mario Hoyek",
        email: "marioh@asisboats.com",
        phone: "+971 50 462 9258"
    },
    soufiane: {
        name: "Soufiane Tangi",
        email: "soufianet@asisboats.com",
        phone: "+971 50 551 2985"
    },
    toji: {
        name: "Toji Paul",
        email: "tojip@asisboats.com",
        phone: "+971 54 791 3337"
    }
};

// ==================== STATE ====================
let state = {
    boatType: null,
    sizeIdx: null,
    currency: 'USD',
    items: {}
};

let itemCounter = 0;

// ==================== INIT ====================
function init() {
    document.getElementById('quoteDate').value = new Date().toISOString().split('T')[0];
    renderBoatTypes();
    updateRateInfo();
}

// Toggle custom delivery input
function toggleDeliveryInput() {
    const select = document.getElementById('deliverySelect');
    const customInput = document.getElementById('deliveryCustom');
    if (select.value === 'custom') {
        customInput.style.display = 'block';
        customInput.focus();
    } else {
        customInput.style.display = 'none';
        customInput.value = '';
    }
}

// Get delivery timeline value
function getDeliveryTimeline() {
    const select = document.getElementById('deliverySelect');
    if (select.value === 'custom') {
        return document.getElementById('deliveryCustom').value || 'TBD';
    }
    return select.value;
}

// ==================== UTILITIES ====================
function fmt(n) { return n.toLocaleString('en-US', {minimumFractionDigits: 0, maximumFractionDigits: 0}); }
function fmtPrice(n) {
    const converted = n * RATES[state.currency];
    const symbol = state.currency === 'EUR' ? '‚Ç¨' : state.currency === 'AED' ? 'AED ' : '$';
    return symbol + fmt(converted);
}
function getSelectedSize() {
    if (state.boatType && state.sizeIdx !== null) {
        return BOATS[state.boatType].sizes[state.sizeIdx].size;
    }
    return null;
}

// ==================== BOAT SELECTION ====================
function renderBoatTypes() {
    const grid = document.getElementById('boatTypesGrid');
    grid.innerHTML = '';
    Object.entries(BOATS).forEach(([key, boat]) => {
        const minPrice = Math.min(...boat.sizes.map(s => s.price));
        grid.innerHTML += `
            <div class="boat-type ${state.boatType === key ? 'selected' : ''}" onclick="selectBoatType('${key}')">
                <div class="boat-type-icon">${boat.icon}</div>
                <h3>${boat.name}</h3>
                <p>${boat.desc}</p>
                <div class="boat-type-stats">
                    <div class="stat"><div class="stat-val">${boat.sizes.length}</div><div class="stat-label">Sizes</div></div>
                    <div class="stat"><div class="stat-val">$${fmt(minPrice)}</div><div class="stat-label">From</div></div>
                </div>
            </div>`;
    });
}

function renderBoatSizes() {
    const grid = document.getElementById('boatSizesGrid');
    const boat = BOATS[state.boatType];
    grid.innerHTML = '';
    boat.sizes.forEach((s, i) => {
        grid.innerHTML += `
            <div class="boat-size ${state.sizeIdx === i ? 'selected' : ''}" onclick="selectBoatSize(${i})">
                <div class="size">${s.size}</div>
                <div class="price">${fmtPrice(s.price)}</div>
                <div class="specs">Fuel: ${s.fuel} | ${s.pax} PAX</div>
            </div>`;
    });
}

function selectBoatType(type) {
    state.boatType = type;
    state.sizeIdx = null;
    state.items = {};
    renderBoatTypes();
    document.getElementById('sizesCard').style.display = 'block';
    renderBoatSizes();
    document.getElementById('nextBtn1').disabled = true;
    updateTotals();
}

function selectBoatSize(idx) {
    state.sizeIdx = idx;
    state.items = {}; // Reset items when size changes
    renderBoatSizes();
    document.getElementById('nextBtn1').disabled = false;
    updateTotals();
    // Auto-advance to step 2
    setTimeout(() => goTo(2), 300);
}

// ==================== CATEGORIES ====================
// Helper function to build category HTML
function buildCategoryHtml(cat, accessories, selectedSize, isFlat, group) {
    const items = accessories[cat];
    if (!items) return { html: '', hasItems: false };
    
    // Filter items available for this size
    const availableItems = items.filter(item => {
        const price = item.prices[selectedSize];
        return price !== 'X' && price !== undefined;
    });
    
    if (availableItems.length === 0) return { html: '', hasItems: false };
    
    const catId = cat.replace(/[^a-zA-Z0-9]/g, '');
    
    // For flat groups, use the group name as header; for seating subcats, remove "Seating - " prefix
    let displayName = cat;
    if (isFlat && group) {
        displayName = group.name;
    } else if (cat.startsWith('Seating - ')) {
        displayName = cat.replace('Seating - ', '');
    }
    
    const categoryClass = isFlat ? 'category flat-category' : 'category';
    
    const html = `
        <div class="${categoryClass}">
            <div class="cat-header" onclick="toggleCategory('${catId}')">
                <h3>${isFlat && group ? `<span style="margin-right:10px;font-size:20px;">${group.icon}</span>` : ''}${displayName} <span style="opacity:0.7;font-weight:400;font-size:11px;">(${availableItems.length} items)</span></h3>
                <div style="display:flex;align-items:center;gap:12px;">
                    <span class="cat-total" id="catTotal-${catId}">$0</span>
                    <span class="arrow">‚ñº</span>
                </div>
            </div>
            <div class="cat-content" id="content-${catId}">
                <div class="cat-inner">
                    <div class="item-grid-header">
                        <span>Description</span>
                        <span>Qty</span>
                        <span>Unit Price</span>
                        <span class="right">Extended</span>
                        <span></span>
                    </div>
                    <div id="items-${catId}"></div>
                    <button class="add-btn" onclick="addItem('${cat}')">+ Add Item</button>
                </div>
            </div>
        </div>`;
    
    return { html, hasItems: true, cat };
}

function buildCategories() {
    const container = document.getElementById('categoriesContainer');
    container.innerHTML = '';
    
    if (!state.boatType) return;
    
    const accessories = ACCESSORIES[state.boatType];
    const groups = CATEGORY_GROUPS[state.boatType];
    const selectedSize = getSelectedSize();
    
    document.getElementById('selectedBoatLabel').textContent = 
        `${BOATS[state.boatType].name} - ${selectedSize}`;
    
    // Track categories to auto-add first item
    const categoriesToInit = [];
    
    // Build each main group
    groups.forEach((group, groupIdx) => {
        let groupHtml = '';
        let groupHasItems = false;
        
        // Build regular categories within this group
        if (group.categories) {
            group.categories.forEach(cat => {
                const result = buildCategoryHtml(cat, accessories, selectedSize, group.flat, group);
                if (result.hasItems) {
                    groupHasItems = true;
                    categoriesToInit.push(result.cat);
                    if (group.flat) {
                        container.innerHTML += result.html;
                    } else {
                        groupHtml += result.html;
                    }
                }
            });
        }
        
        // Build subgroups (e.g., Seating containing Leaning Posts, Jockey, etc.)
        if (group.subgroups) {
            group.subgroups.forEach((subgroup, subgroupIdx) => {
                let subgroupHtml = '';
                let subgroupHasItems = false;
                
                subgroup.categories.forEach(cat => {
                    const result = buildCategoryHtml(cat, accessories, selectedSize, false, null);
                    if (result.hasItems) {
                        subgroupHasItems = true;
                        groupHasItems = true;
                        categoriesToInit.push(result.cat);
                        subgroupHtml += result.html;
                    }
                });
                
                if (subgroupHasItems) {
                    const subgroupId = `subgroup-${groupIdx}-${subgroupIdx}`;
                    groupHtml += `
                        <div class="subgroup">
                            <div class="subgroup-header" onclick="toggleSubgroup('${subgroupId}')">
                                <h4>${subgroup.name}</h4>
                                <div style="display:flex;align-items:center;">
                                    <span class="subgroup-total" id="subgroupTotal-${subgroupId}">$0</span>
                                    <span class="subgroup-arrow">‚ñº</span>
                                </div>
                            </div>
                            <div class="subgroup-content" id="${subgroupId}">
                                <div class="subgroup-inner">
                                    ${subgroupHtml}
                                </div>
                            </div>
                        </div>`;
                }
            });
        }
        
        if (!groupHasItems) return;
        
        // For non-flat groups, wrap in main group container
        if (!group.flat && groupHtml) {
            const groupId = 'group-' + groupIdx;
            container.innerHTML += `
                <div class="main-group">
                    <div class="main-group-header" onclick="toggleMainGroup('${groupId}')">
                        <h2><span class="group-icon">${group.icon}</span> ${group.name}</h2>
                        <div style="display:flex;align-items:center;">
                            <span class="group-total" id="groupTotal-${groupIdx}">$0</span>
                            <span class="group-arrow">‚ñº</span>
                        </div>
                    </div>
                    <div class="main-group-content" id="${groupId}">
                        <div class="main-group-inner">
                            ${groupHtml}
                        </div>
                    </div>
                </div>`;
        }
    });
    
    // Auto-add first item row to each category
    categoriesToInit.forEach(cat => {
        addItem(cat);
    });
}

function toggleMainGroup(groupId) {
    const content = document.getElementById(groupId);
    const header = content.previousElementSibling;
    content.classList.toggle('open');
    header.classList.toggle('open');
}

function toggleSubgroup(subgroupId) {
    const content = document.getElementById(subgroupId);
    const header = content.previousElementSibling;
    content.classList.toggle('open');
    header.classList.toggle('open');
}

function toggleCategory(catId) {
    const content = document.getElementById('content-' + catId);
    const header = content.previousElementSibling;
    content.classList.toggle('open');
    header.classList.toggle('open');
}

function addItem(category) {
    const catId = category.replace(/[^a-zA-Z0-9]/g, '');
    const itemsDiv = document.getElementById('items-' + catId);
    const id = ++itemCounter;
    const selectedSize = getSelectedSize();
    const accessories = ACCESSORIES[state.boatType][category];
    
    // Build options - only show items available for this size
    let options = '<option value="">-- Select Item --</option>';
    accessories.forEach((item, i) => {
        const price = item.prices[selectedSize];
        if (price === 'X' || price === undefined) return; // Skip unavailable
        
        let priceDisplay;
        if (price === 'TBD') {
            priceDisplay = 'TBD';
        } else if (price === 'Incl.') {
            priceDisplay = 'Included';
        } else {
            priceDisplay = '$' + fmt(price);
        }
        options += `<option value="${i}">${item.name} - ${priceDisplay}</option>`;
    });
    options += '<option value="custom">+ Custom Item</option>';
    
    const row = document.createElement('div');
    row.className = 'item-row';
    row.id = 'row-' + id;
    row.innerHTML = `
        <select onchange="itemSelected(this, '${category}', ${id})">${options}</select>
        <input type="number" value="1" min="1" id="qty-${id}" onchange="updateItemQty(${id}, '${category}')">
        <input type="text" class="price-input" id="price-${id}" value="$0" onchange="updateItemPrice(${id}, '${category}')">
        <div class="extended" id="ext-${id}">$0</div>
        <button class="delete-btn" onclick="removeItem(${id}, '${category}')">√ó</button>
    `;
    itemsDiv.appendChild(row);
    
    if (!state.items[category]) state.items[category] = {};
    state.items[category][id] = {itemIdx: null, qty: 1, price: 0, name: '', isCustom: false, isTBD: false};
}

function itemSelected(select, category, id) {
    const val = select.value;
    const priceInput = document.getElementById('price-' + id);
    const extDiv = document.getElementById('ext-' + id);
    const selectedSize = getSelectedSize();
    
    if (val === 'custom') {
        const parent = select.parentElement;
        const input = document.createElement('input');
        input.type = 'text';
        input.className = 'custom-input';
        input.placeholder = 'Enter custom item name...';
        input.id = 'name-' + id;
        input.onchange = () => updateCustomItem(id, category);
        parent.replaceChild(input, select);
        
        state.items[category][id].isCustom = true;
        state.items[category][id].itemIdx = -1;
        priceInput.value = '$0';
        priceInput.focus();
    } else if (val !== '') {
        const itemIdx = parseInt(val);
        const item = ACCESSORIES[state.boatType][category][itemIdx];
        const price = item.prices[selectedSize];
        
        state.items[category][id].itemIdx = itemIdx;
        state.items[category][id].name = item.name;
        
        if (price === 'TBD') {
            state.items[category][id].price = 0;
            state.items[category][id].isTBD = true;
            priceInput.value = 'TBD';
            priceInput.disabled = true;
            extDiv.innerHTML = '<span class="tbd">TBD</span>';
        } else if (price === 'Incl.') {
            state.items[category][id].price = 0;
            state.items[category][id].isTBD = false;
            priceInput.value = 'Included';
            priceInput.disabled = true;
            extDiv.textContent = 'Incl.';
        } else {
            state.items[category][id].price = price;
            state.items[category][id].isTBD = false;
            priceInput.value = '$' + fmt(price);
            priceInput.disabled = false;
        }
    } else {
        state.items[category][id].itemIdx = null;
        state.items[category][id].price = 0;
        state.items[category][id].name = '';
        state.items[category][id].isTBD = false;
        priceInput.value = '$0';
        priceInput.disabled = false;
    }
    
    updateItemExtended(id, category);
    updateCategoryTotal(category);
    updateTotals();
}

function updateCustomItem(id, category) {
    const nameInput = document.getElementById('name-' + id);
    state.items[category][id].name = nameInput.value;
}

function updateItemQty(id, category) {
    const qty = parseInt(document.getElementById('qty-' + id).value) || 1;
    state.items[category][id].qty = qty;
    updateItemExtended(id, category);
    updateCategoryTotal(category);
    updateTotals();
}

function updateItemPrice(id, category) {
    const priceInput = document.getElementById('price-' + id);
    const price = parseFloat(priceInput.value.replace(/[^0-9.]/g, '')) || 0;
    state.items[category][id].price = price;
    priceInput.value = '$' + fmt(price);
    updateItemExtended(id, category);
    updateCategoryTotal(category);
    updateTotals();
}

function updateItemExtended(id, category) {
    const item = state.items[category][id];
    if (item.isTBD) {
        document.getElementById('ext-' + id).innerHTML = '<span class="tbd">TBD</span>';
    } else {
        const extended = item.price * item.qty;
        document.getElementById('ext-' + id).textContent = '$' + fmt(extended);
    }
}

function removeItem(id, category) {
    document.getElementById('row-' + id).remove();
    delete state.items[category][id];
    updateCategoryTotal(category);
    updateTotals();
}

function updateCategoryTotal(category) {
    const catId = category.replace(/[^a-zA-Z0-9]/g, '');
    let total = 0;
    if (state.items[category]) {
        Object.values(state.items[category]).forEach(item => {
            if (item.price && item.qty && !item.isTBD) {
                total += item.price * item.qty;
            }
        });
    }
    const el = document.getElementById('catTotal-' + catId);
    if (el) el.textContent = '$' + fmt(total);
}

// ==================== TOTALS ====================
function updateTotals() {
    const base = state.boatType && state.sizeIdx !== null ? BOATS[state.boatType].sizes[state.sizeIdx].price : 0;
    let options = 0;
    
    Object.values(state.items).forEach(cat => {
        Object.values(cat).forEach(item => {
            if (item.price && item.qty && !item.isTBD) {
                options += item.price * item.qty;
            }
        });
    });
    
    const subtotal = base + options;
    const discountPct = parseFloat(document.getElementById('discount')?.value) || 0;
    const discount = subtotal * (discountPct / 100);
    const total = subtotal - discount;
    
    // Update summaries
    document.getElementById('sumType').textContent = state.boatType ? BOATS[state.boatType].name : '-';
    document.getElementById('sumSize').textContent = state.sizeIdx !== null ? BOATS[state.boatType].sizes[state.sizeIdx].size : '-';
    document.getElementById('sumBase').textContent = base ? fmtPrice(base) : '-';
    document.getElementById('sumOptions').textContent = fmtPrice(options);
    document.getElementById('sumTotal').textContent = fmtPrice(total);
    
    const sumTotal2 = document.getElementById('sumTotal2');
    if (sumTotal2) sumTotal2.textContent = fmtPrice(total);
    
    const sumSub3 = document.getElementById('sumSub3');
    if (sumSub3) sumSub3.textContent = fmtPrice(subtotal);
    const sumDisc3 = document.getElementById('sumDisc3');
    if (sumDisc3) sumDisc3.textContent = '-' + fmtPrice(discount);
    const sumTotal3 = document.getElementById('sumTotal3');
    if (sumTotal3) sumTotal3.textContent = fmtPrice(total);
    
    // Update selected items list
    updateSelectedItemsList();
}

function updateSelectedItemsList() {
    const list = document.getElementById('selectedItemsList');
    if (!list) return;
    
    let html = '';
    if (state.boatType && state.sizeIdx !== null) {
        html += `<div class="sel-item"><span class="name">${BOATS[state.boatType].sizes[state.sizeIdx].size} ${BOATS[state.boatType].name}</span><span class="amt">${fmtPrice(BOATS[state.boatType].sizes[state.sizeIdx].price)}</span></div>`;
    }
    
    Object.entries(state.items).forEach(([cat, items]) => {
        Object.values(items).forEach(item => {
            if (item.name) {
                const amt = item.isTBD ? 'TBD' : fmtPrice(item.price * item.qty);
                html += `<div class="sel-item"><span class="name">${item.qty}x ${item.name}</span><span class="amt">${amt}</span></div>`;
            }
        });
    });
    
    list.innerHTML = html || '<div style="color:var(--gray-500);font-size:12px;">No items selected</div>';
}

// ==================== CURRENCY ====================
function setCurrency(curr) {
    state.currency = curr;
    document.querySelectorAll('.curr-btn').forEach(b => b.classList.remove('active'));
    document.querySelectorAll(`.curr-btn`).forEach(b => {
        if (b.textContent === curr) b.classList.add('active');
    });
    if (state.boatType) renderBoatSizes();
    updateTotals();
}

// ==================== NAVIGATION ====================
function goTo(page) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.getElementById('page' + page).classList.add('active');
    
    document.querySelectorAll('.step').forEach((s, i) => {
        s.classList.remove('active', 'done');
        if (i + 1 < page) s.classList.add('done');
        if (i + 1 === page) s.classList.add('active');
    });
    
    if (page === 2) {
        buildCategories();
    }
    if (page === 3) {
        // Set default quotation title based on boat type and size
        const titleField = document.getElementById('quoteTitle');
        if (!titleField.value) {
            const size = getSelectedSize();
            const boatType = state.boatType;
            if (size && boatType) {
                let typeName = '';
                if (boatType === 'aluminum') typeName = 'Aluminum RIB Boats';
                else if (boatType === 'fiberglass') typeName = 'Fiberglass RIB Boats';
                else if (boatType === 'inflatable') typeName = 'Inflatable Boats';
                titleField.value = `${size} ${typeName}`;
            }
        }
    }
    if (page === 4) {
        buildPreview();
    }
    
    window.scrollTo(0, 0);
}

// ==================== PREVIEW ====================
function buildPreview() {
    const boat = BOATS[state.boatType].sizes[state.sizeIdx];
    const salesmanKey = document.getElementById('salesman').value;
    const salesmanInfo = salesmanKey ? SALESMEN[salesmanKey] : null;
    const tender = document.getElementById('tenderNum').value;
    const hideSubPrices = document.getElementById('hideSubPrices').checked;
    const quoteTitle = document.getElementById('quoteTitle').value;
    
    // Set quotation title in preview
    document.getElementById('prevQuoteTitle').textContent = quoteTitle;
    
    // Quote info with salesman details
    let salesmanHtml = '';
    if (salesmanInfo) {
        salesmanHtml = `
            Salesman: ${salesmanInfo.name}<br>
            ‚úâ ${salesmanInfo.email}<br>
            ‚òé ${salesmanInfo.phone}<br>
        `;
    }
    
    document.getElementById('prevQuoteInfo').innerHTML = `
        Quote #: ${document.getElementById('quoteNum').value}<br>
        Date: ${document.getElementById('quoteDate').value}<br>
        Validity: ${document.getElementById('validity').value}<br>
        ${salesmanHtml}
        Payment: ${document.getElementById('payTerms').value}<br>
        Delivery Terms: ${document.getElementById('deliveryTerms').value}<br>
        Delivery Timeline: ${getDeliveryTimeline()}
    `;
    
    document.getElementById('prevCustInfo').innerHTML = `
        ${document.getElementById('custCompany').value || '-'}<br>
        ${document.getElementById('custName').value || '-'}<br>
        ${document.getElementById('custEmail').value || '-'}<br>
        ${document.getElementById('custPhone').value || '-'}<br>
        ${tender ? 'Tender: ' + tender + '<br>' : ''}
        ${document.getElementById('custAddr').value || ''}
    `;
    
    // Calculate totals first
    let options = 0;
    Object.values(state.items).forEach(cat => {
        Object.values(cat).forEach(item => {
            if (item.price && item.qty && !item.isTBD) {
                options += item.price * item.qty;
            }
        });
    });
    
    const subtotal = boat.price + options;
    const discountPct = parseFloat(document.getElementById('discount').value) || 0;
    const discount = subtotal * (discountPct / 100);
    const total = subtotal - discount;
    
    // Items table
    let itemsHtml = '';
    if (hideSubPrices) {
        // Show items but hide individual prices - only show total at the end
        itemsHtml = `<tr><td><strong>${BOATS[state.boatType].name} - ${boat.size}</strong></td><td>1</td><td class="right">-</td><td class="right">-</td></tr>`;
        
        Object.entries(state.items).forEach(([cat, items]) => {
            Object.values(items).forEach(item => {
                if (item.name) {
                    itemsHtml += `<tr><td>${item.name}</td><td>${item.qty}</td><td class="right">-</td><td class="right">-</td></tr>`;
                }
            });
        });
    } else {
        // Show full details with prices
        itemsHtml = `<tr><td><strong>${BOATS[state.boatType].name} - ${boat.size}</strong></td><td>1</td><td class="right">${fmtPrice(boat.price)}</td><td class="right">${fmtPrice(boat.price)}</td></tr>`;
        
        Object.entries(state.items).forEach(([cat, items]) => {
            Object.values(items).forEach(item => {
                if (item.name) {
                    const unitPrice = item.isTBD ? 'TBD' : fmtPrice(item.price);
                    const itemTotal = item.isTBD ? 'TBD' : fmtPrice(item.price * item.qty);
                    itemsHtml += `<tr><td>${item.name}</td><td>${item.qty}</td><td class="right">${unitPrice}</td><td class="right">${itemTotal}</td></tr>`;
                }
            });
        });
    }
    
    document.getElementById('prevItems').innerHTML = itemsHtml;
    
    // Totals
    if (hideSubPrices) {
        document.getElementById('prevTotals').innerHTML = `
            ${discountPct > 0 ? `<div>Discount: ${discountPct}%</div>` : ''}
            <div class="grand">TOTAL: ${fmtPrice(total)}</div>
        `;
    } else {
        document.getElementById('prevTotals').innerHTML = `
            <div>Subtotal: ${fmtPrice(subtotal)}</div>
            ${discountPct > 0 ? `<div>Discount (${discountPct}%): -${fmtPrice(discount)}</div>` : ''}
            <div class="grand">TOTAL: ${fmtPrice(total)}</div>
        `;
    }
    
    // Notes
    const notes = document.getElementById('quoteNotes').value;
    if (notes) {
        document.getElementById('prevNotes').style.display = 'block';
        document.getElementById('prevNotesText').textContent = notes;
    } else {
        document.getElementById('prevNotes').style.display = 'none';
    }
}

// ==================== EXPORT ====================
function downloadPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    
    const boat = BOATS[state.boatType].sizes[state.sizeIdx];
    const salesmanKey = document.getElementById('salesman').value;
    const salesmanInfo = salesmanKey ? SALESMEN[salesmanKey] : null;
    const tender = document.getElementById('tenderNum').value;
    const hideSubPrices = document.getElementById('hideSubPrices').checked;
    
    // Calculate totals first
    let options = 0;
    Object.values(state.items).forEach(cat => {
        Object.values(cat).forEach(item => {
            if (item.price && item.qty && !item.isTBD) {
                options += item.price * item.qty;
            }
        });
    });
    
    const subtotal = boat.price + options;
    const discountPct = parseFloat(document.getElementById('discount').value) || 0;
    const discount = subtotal * (discountPct / 100);
    const total = subtotal - discount;
    
    // Header
    doc.setFillColor(15, 40, 71);
    doc.rect(0, 0, 210, 40, 'F');
    doc.setTextColor(255, 255, 255);
    doc.setFontSize(24);
    doc.text('ASIS BOATS LLC', 105, 20, {align: 'center'});
    doc.setFontSize(12);
    doc.setTextColor(201, 162, 39);
    doc.text('PROFESSIONAL QUOTATION', 105, 30, {align: 'center'});
    
    // Quote info
    doc.setTextColor(0, 0, 0);
    doc.setFontSize(10);
    let y = 50;
    
    doc.setFont(undefined, 'bold');
    doc.text('Quote Details:', 15, y);
    doc.setFont(undefined, 'normal');
    y += 7;
    doc.text(`Quote #: ${document.getElementById('quoteNum').value}`, 15, y);
    y += 5;
    doc.text(`Date: ${document.getElementById('quoteDate').value}`, 15, y);
    y += 5;
    doc.text(`Validity: ${document.getElementById('validity').value}`, 15, y);
    y += 5;
    doc.text(`Payment: ${document.getElementById('payTerms').value}`, 15, y);
    y += 5;
    doc.text(`Delivery Terms: ${document.getElementById('deliveryTerms').value}`, 15, y);
    y += 5;
    doc.text(`Delivery Timeline: ${getDeliveryTimeline()}`, 15, y);
    if (salesmanInfo) {
        y += 7;
        doc.setFont(undefined, 'bold');
        doc.text(`Salesman: ${salesmanInfo.name}`, 15, y);
        doc.setFont(undefined, 'normal');
        y += 5;
        doc.text(`${salesmanInfo.email}`, 15, y);
        y += 5;
        doc.text(`${salesmanInfo.phone}`, 15, y);
    }
    
    // Customer info
    y = 50;
    doc.setFont(undefined, 'bold');
    doc.text('Customer:', 110, y);
    doc.setFont(undefined, 'normal');
    y += 7;
    doc.text(document.getElementById('custCompany').value || '-', 110, y);
    y += 5;
    doc.text(document.getElementById('custName').value || '-', 110, y);
    y += 5;
    doc.text(document.getElementById('custEmail').value || '-', 110, y);
    y += 5;
    doc.text(document.getElementById('custPhone').value || '-', 110, y);
    if (tender) {
        y += 5;
        doc.text(`Tender: ${tender}`, 110, y);
    }
    
    // Items table
    y = 115;
    doc.setFillColor(15, 40, 71);
    doc.rect(15, y, 180, 8, 'F');
    doc.setTextColor(255, 255, 255);
    doc.setFontSize(9);
    doc.text('Description', 17, y + 5.5);
    doc.text('Qty', 130, y + 5.5);
    if (!hideSubPrices) {
        doc.text('Unit Price', 150, y + 5.5);
        doc.text('Total', 180, y + 5.5);
    }
    
    y += 10;
    doc.setTextColor(0, 0, 0);
    
    // Boat
    doc.text(`${BOATS[state.boatType].name} - ${boat.size}`, 17, y + 4);
    doc.text('1', 130, y + 4);
    if (!hideSubPrices) {
        doc.text(fmtPrice(boat.price), 150, y + 4);
        doc.text(fmtPrice(boat.price), 175, y + 4);
    }
    y += 8;
    
    // Options
    Object.entries(state.items).forEach(([cat, items]) => {
        Object.values(items).forEach(item => {
            if (item.name && y < 260) {
                const name = item.name.length > 55 ? item.name.substring(0, 52) + '...' : item.name;
                doc.text(name, 17, y + 4);
                doc.text(item.qty.toString(), 130, y + 4);
                if (!hideSubPrices) {
                    const unitPrice = item.isTBD ? 'TBD' : fmtPrice(item.price);
                    const itemTotal = item.isTBD ? 'TBD' : fmtPrice(item.price * item.qty);
                    doc.text(unitPrice, 150, y + 4);
                    doc.text(itemTotal, 175, y + 4);
                }
                y += 7;
            }
        });
    });
    
    // Totals
    y += 5;
    doc.line(15, y, 195, y);
    y += 7;
    
    if (!hideSubPrices) {
        doc.text(`Subtotal: ${fmtPrice(subtotal)}`, 150, y);
        if (discountPct > 0) {
            y += 6;
            doc.text(`Discount (${discountPct}%): -${fmtPrice(discount)}`, 150, y);
        }
        y += 8;
    } else {
        if (discountPct > 0) {
            doc.text(`Discount: ${discountPct}%`, 150, y);
            y += 8;
        }
    }
    
    doc.setFont(undefined, 'bold');
    doc.setFontSize(12);
    doc.text(`TOTAL: ${fmtPrice(total)}`, 150, y);
    
    // Notes
    const notes = document.getElementById('quoteNotes').value;
    if (notes && y < 250) {
        y += 15;
        doc.setFontSize(10);
        doc.setFont(undefined, 'bold');
        doc.text('Notes:', 15, y);
        doc.setFont(undefined, 'normal');
        y += 6;
        const splitNotes = doc.splitTextToSize(notes, 170);
        doc.text(splitNotes, 15, y);
    }
    
    // Footer
    doc.setFontSize(8);
    doc.setTextColor(100, 100, 100);
    doc.text('ASIS Boats L.L.C, Jebel Ali Industrial Area 2, Dubai, UAE | Tel: +971 880 4441 | www.asisboats.com', 105, 290, {align: 'center'});
    
    doc.save(`${document.getElementById('quoteNum').value}.pdf`);
}

function downloadCSV() {
    const boat = BOATS[state.boatType].sizes[state.sizeIdx];
    const salesman = document.getElementById('salesman').value;
    
    let csv = 'Description,Quantity,Unit Price,Total\n';
    csv += `"${BOATS[state.boatType].name} - ${boat.size}",1,${boat.price},${boat.price}\n`;
    
    Object.entries(state.items).forEach(([cat, items]) => {
        Object.values(items).forEach(item => {
            if (item.name) {
                const total = item.isTBD ? 'TBD' : item.price * item.qty;
                const price = item.isTBD ? 'TBD' : item.price;
                csv += `"${item.name}",${item.qty},${price},${total}\n`;
            }
        });
    });
    
    csv += `\nQuote #,${document.getElementById('quoteNum').value}\n`;
    csv += `Date,${document.getElementById('quoteDate').value}\n`;
    csv += `Salesman,${salesman}\n`;
    csv += `Customer,${document.getElementById('custCompany').value}\n`;
    
    const blob = new Blob([csv], {type: 'text/csv'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${document.getElementById('quoteNum').value}.csv`;
    a.click();
}

// Init
init();
</script>
</body>
</html>
